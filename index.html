<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø§Øª Ø§Ù„Ø­Ø¨ - ØªØ·Ø¨ÙŠÙ‚ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ Ù„Ù„Ø£Ø²ÙˆØ§Ø¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ø¥Ø¶Ø§ÙØ© Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary-color: #e91e63;
            --secondary-color: #c2185b;
            --accent-color: #f8bbd9;
            --light-color: #fce4ec;
            --dark-color: #880e4f;
            --bg-color: #fff5f8;
            --chat-bg: #ffffff;
            --user-message: #e91e63;
            --other-message: #f8bbd9;
            --gradient: linear-gradient(135deg, #e91e63, #f8bbd9);
            --highlight-color: #fff9c4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--dark-color);
            height: 100vh;
            overflow: hidden;
            background-image: linear-gradient(rgba(255, 245, 248, 0.9), rgba(255, 245, 248, 0.9)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23e91e63" opacity="0.1" d="M50,30 C60,20 80,25 80,40 C80,55 65,60 50,70 C35,60 20,55 20,40 C20,25 40,20 50,30 Z"/></svg>');
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            margin: 0 auto;
        }

        /* Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        .header {
            background: var(--gradient);
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(233, 30, 99, 0.2);
            min-height: 60px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="50" height="50" opacity="0.1"><path fill="%23ffffff" d="M50,30 C60,20 80,25 80,40 C80,55 65,60 50,70 C35,60 20,55 20,40 C20,25 40,20 50,30 Z"/></svg>');
        }

        .header h1 {
            font-size: 1.2rem;
            font-weight: 600;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .chat-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
        .users-sidebar {
            width: 250px;
            background-color: white;
            border-left: 1px solid #ffcdd2;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            box-shadow: -2px 0 10px rgba(233, 30, 99, 0.1);
            flex-shrink: 0;
        }

        .users-header {
            padding: 12px 15px;
            background-color: var(--light-color);
            border-bottom: 1px solid #ffcdd2;
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .users-list {
            flex: 1;
            overflow-y: auto;
        }

        .user-item {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #fce4ec;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .user-item:hover {
            background-color: #fce4ec;
        }

        .user-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4caf50;
        }

        .user-status.offline {
            background-color: #9e9e9e;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .messages-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--chat-bg);
            position: relative;
            min-width: 0;
        }

        .messages-header {
            padding: 12px 15px;
            background-color: white;
            border-bottom: 1px solid #ffcdd2;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: var(--dark-color);
            flex-shrink: 0;
        }

        .search-container {
            padding: 10px 15px;
            background-color: white;
            border-bottom: 1px solid #ffcdd2;
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .search-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ffcdd2;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
        }

        .search-input:focus {
            border-color: var(--primary-color);
        }

        .messages-container {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: var(--bg-color);
        }

        .message {
            max-width: 85%;
            padding: 10px 12px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            font-size: 0.95rem;
            animation: messageAppear 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--user-message);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.other {
            align-self: flex-start;
            background-color: var(--other-message);
            color: var(--dark-color);
            border-bottom-left-radius: 5px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .message-actions {
            position: absolute;
            top: -8px;
            right: 8px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            padding: 4px;
        }

        .message:hover .message-actions {
            display: flex;
        }

        .message-action {
            margin: 0 4px;
            cursor: pointer;
            color: var(--dark-color);
            font-size: 0.8rem;
            transition: color 0.2s;
        }

        .message-action:hover {
            color: var(--primary-color);
        }

        .reply-indicator {
            background-color: rgba(255, 255, 255, 0.3);
            border-right: 3px solid var(--primary-color);
            padding: 6px 10px;
            border-radius: 8px;
            margin-bottom: 5px;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .file-attachment {
            margin-top: 8px;
            padding: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
        }

        .file-attachment img {
            max-width: 200px;
            border-radius: 8px;
            cursor: pointer;
        }

        .file-attachment video {
            max-width: 250px;
            border-radius: 8px;
            cursor: pointer;
        }

        .gif-attachment {
            margin-top: 8px;
            border-radius: 8px;
            overflow: hidden;
        }

        .gif-attachment img {
            max-width: 200px;
            border-radius: 8px;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ */
        .input-area {
            padding: 12px 15px;
            background-color: white;
            border-top: 1px solid #ffcdd2;
            display: flex;
            gap: 8px;
            align-items: flex-end;
            position: relative;
            flex-shrink: 0;
            min-height: 70px;
        }

        .message-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ffcdd2;
            border-radius: 24px;
            outline: none;
            resize: none;
            height: 45px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
            min-width: 0;
        }

        .message-input:focus {
            border-color: var(--primary-color);
        }

        .action-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gradient);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(233, 30, 99, 0.2);
            flex-shrink: 0;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(233, 30, 99, 0.3);
        }

        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--gradient);
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100" opacity="0.1"><path fill="%23ffffff" d="M50,30 C60,20 80,25 80,40 C80,55 65,60 50,70 C35,60 20,55 20,40 C20,25 40,20 50,30 Z"/></svg>');
        }

        .auth-box {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 350px;
            position: relative;
            z-index: 1;
        }

        .auth-box h2 {
            text-align: center;
            margin-bottom: 15px;
            color: var(--dark-color);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .quick-login {
            margin-top: 15px;
            text-align: center;
        }

        .quick-login button {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 12px;
            border-radius: 25px;
            cursor: pointer;
            margin: 4px 0;
            width: 100%;
            font-size: 0.9rem;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(233, 30, 99, 0.2);
        }

        .quick-login button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(233, 30, 99, 0.3);
        }

        .hidden {
            display: none;
        }

        /* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ */
        @media (max-width: 768px) {
            .users-sidebar {
                position: absolute;
                top: 60px;
                right: 0;
                bottom: 0;
                z-index: 100;
                transform: translateX(100%);
                width: 280px;
            }
            
            .users-sidebar.active {
                transform: translateX(0);
            }
            
            .message {
                max-width: 90%;
            }
            
            .emoji-picker, .gif-picker, .file-upload-container {
                width: 300px !important;
                right: 10px !important;
                bottom: 60px !important;
            }
            
            .header h1 {
                font-size: 1.1rem;
            }

            .input-area {
                padding: 10px 12px;
                gap: 6px;
                min-height: 65px;
                display: flex !important;
                visibility: visible !important;
            }

            .action-btn {
                width: 40px;
                height: 40px;
                font-size: 0.8rem;
                display: flex !important;
            }

            .message-input {
                height: 40px;
                font-size: 0.85rem;
                display: block !important;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
            }
            
            .messages-container {
                padding: 10px;
            }
            
            .input-area {
                padding: 8px 10px;
                min-height: 60px;
                flex-wrap: nowrap;
            }
            
            .message {
                max-width: 95%;
                padding: 8px 10px;
            }
            
            .emoji-picker, .gif-picker, .file-upload-container {
                width: 280px !important;
                right: 5px !important;
            }

            .action-btn {
                width: 38px;
                height: 38px;
            }

            .users-sidebar {
                width: 100%;
            }
        }

        /* Ø­Ù„ Ø·Ø§Ø±Ø¦ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ ÙÙŠ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-width: 768px) {
            .input-area {
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
                min-height: 70px !important;
                position: relative !important;
                background: white !important;
                z-index: 1000 !important;
            }
            
            .input-area * {
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .action-btn, .emoji-btn, .gif-btn {
                display: flex !important;
                visibility: visible !important;
                width: 40px !important;
                height: 40px !important;
                min-width: 40px !important;
            }
            
            .message-input {
                display: block !important;
                visibility: visible !important;
                flex: 1 !important;
            }
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .typing-indicator {
            padding: 4px 12px;
            font-style: italic;
            color: var(--dark-color);
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .message-reactions {
            display: flex;
            margin-top: 6px;
            gap: 4px;
            flex-wrap: wrap;
        }

        .reaction {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 2px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .reaction:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .reaction-count {
            font-size: 0.65rem;
        }

        .reaction-picker {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            padding: 6px;
            display: none;
            z-index: 100;
        }

        .reaction-option {
            font-size: 1.3rem;
            padding: 4px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .reaction-option:hover {
            transform: scale(1.2);
        }

        /* Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .emoji-btn, .gif-btn {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 4px;
            color: var(--primary-color);
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .emoji-btn:hover, .gif-btn:hover {
            transform: scale(1.1);
        }

        .emoji-picker, .gif-picker {
            position: absolute;
            bottom: 60px;
            right: 15px;
            width: 320px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            padding: 12px;
            z-index: 1000;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .emoji-category, .gif-category {
            margin-bottom: 8px;
        }

        .emoji-category h4, .gif-category h4 {
            margin-bottom: 6px;
            color: var(--dark-color);
            border-bottom: 1px solid #ffcdd2;
            padding-bottom: 4px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
        }

        .emoji {
            font-size: 1.3rem;
            cursor: pointer;
            text-align: center;
            padding: 4px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .emoji:hover {
            background-color: #fce4ec;
        }

        /* Ù…ÙƒØªØ¨Ø© GIF */
        .gif-search {
            margin-bottom: 10px;
        }

        .gif-search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ffcdd2;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
        }

        .gif-search-input:focus {
            border-color: var(--primary-color);
        }

        .gif-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }

        .gif-item {
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
            position: relative;
        }

        .gif-item:hover {
            transform: scale(1.03);
        }

        .gif-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--gradient);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            display: none;
            font-size: 0.85rem;
            max-width: 300px;
        }

        /* Ø²Ø± Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .mobile-users-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .mobile-users-toggle {
                display: block;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù‚Ù„ÙˆØ¨ ÙˆØ§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .floating-emoji {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            font-size: 2.5rem;
            animation: floatDown 6s ease-in-out forwards;
            user-select: none;
            opacity: 1;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
            filter: drop-shadow(0 0 5px rgba(233, 30, 99, 0.3));
        }

        @keyframes floatDown {
            0% {
                transform: translateY(-100px) scale(0.8) rotate(0deg);
                opacity: 1;
            }
            70% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) scale(1.2) rotate(360deg);
                opacity: 0;
            }
        }

        .emoji-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .emoji-drop {
            position: absolute;
            font-size: 2rem;
            animation: emojiRainFall 5s linear forwards;
            user-select: none;
            opacity: 1;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            filter: drop-shadow(0 0 3px rgba(233, 30, 99, 0.4));
        }

        @keyframes emojiRainFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            80% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .heart {
            position: absolute;
            pointer-events: none;
            opacity: 0.8;
            animation: float 3s ease-in-out forwards;
        }

        @keyframes float {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(0.5);
                opacity: 0;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª */
        .bubble {
            position: absolute;
            background: rgba(233, 30, 99, 0.1);
            border-radius: 50%;
            pointer-events: none;
            animation: bubble 2s ease-in-out forwards;
        }

        @keyframes bubble {
            0% {
                transform: scale(0);
                opacity: 0.8;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Ø«ÙŠÙ…Ø§Øª */
        .theme-selector {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
        }

        .theme-btn {
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .theme-options {
            position: absolute;
            top: 50px;
            left: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 5px;
            min-width: 150px;
        }

        .theme-option {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: right;
            transition: background-color 0.2s;
        }

        .theme-option:hover {
            background-color: #fce4ec;
        }

        /* Ø®Ù„ÙÙŠØ© Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© */
        .romantic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(233, 30, 99, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(248, 187, 217, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(192, 24, 91, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« */
        .highlight {
            background-color: var(--highlight-color);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        .message.highlighted {
            animation: pulseHighlight 2s ease-in-out;
            border: 2px solid var(--highlight-color);
        }

        @keyframes pulseHighlight {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 249, 196, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 249, 196, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 249, 196, 0);
            }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
        .file-upload-container {
            position: absolute;
            bottom: 70px;
            right: 15px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            padding: 15px;
            z-index: 1000;
            display: none;
            min-width: 200px;
        }

        .upload-option {
            padding: 10px 15px;
            border: none;
            background: none;
            text-align: right;
            width: 100%;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--dark-color);
        }

        .upload-option:hover {
            background-color: #fce4ec;
        }

        .file-input {
            display: none;
        }

        .upload-progress {
            width: 100%;
            height: 4px;
            background-color: #f0f0f0;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
            display: none;
        }

        .upload-progress-bar {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .preview-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .preview-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .preview-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
        }

        .preview-video {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .close-preview {
            position: absolute;
            top: 10px;
            left: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }
    </style>
</head>
<body>
    <!-- Ø®Ù„ÙÙŠØ© Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© -->
    <div class="romantic-bg"></div>

    <!-- Ù…Ù†Ø·Ù‚Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ -->
    <div class="emoji-rain" id="emojiRain"></div>

    <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="notification" id="notification"></div>

    <!-- Ø«ÙŠÙ…Ø§Øª -->
    <div class="theme-selector">
        <button class="theme-btn" id="themeBtn">
            <i class="fas fa-palette"></i>
        </button>
        <div class="theme-options" id="themeOptions">
            <button class="theme-option" data-theme="romantic">Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ ğŸ’–</button>
            <button class="theme-option" data-theme="classic">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ ğŸ’•</button>
            <button class="theme-option" data-theme="elegant">Ø£Ù†ÙŠÙ‚ ğŸŒ¹</button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="authScreen" class="auth-container">
        <div class="auth-box">
            <h2><i class="fas fa-heart"></i> Ø´Ø§Øª Ø§Ù„Ø­Ø¨</h2>
            <p style="text-align: center; margin-bottom: 15px; color: var(--dark-color); font-size: 0.9rem;">
                Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØªÙƒ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø¹Ø§Ù„Ù… Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©
            </p>
            
            <div class="quick-login">
                <button id="loginUser1">
                    <i class="fas fa-heart"></i> Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ Ø£Ø­Ù…Ø¯
                </button>
                <button id="loginUser2">
                    <i class="fas fa-heart"></i> Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ Ø³Ø§Ø±Ø©
                </button>
            </div>
            
            <div style="margin-top: 15px; padding: 12px; background-color: #fce4ec; border-radius: 10px;">
                <h4 style="margin-bottom: 8px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px;"><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</h4>
                <p style="font-size: 0.8rem; color: var(--dark-color);">
                    ØªØ·Ø¨ÙŠÙ‚ Ø´Ø§Øª Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ Ù…Ø®ØµØµ Ù„Ù„Ø£Ø²ÙˆØ§Ø¬. Ø§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨Ø© ÙØ±ÙŠØ¯Ø© Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©.
                </p>
            </div>
        </div>
    </div>

    <!-- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø´Ø§Øª -->
    <div id="chatApp" class="container hidden">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
        <div class="header">
            <div style="display: flex; align-items: center;">
                <button class="mobile-users-toggle" id="mobileUsersToggle">
                    <i class="fas fa-users"></i>
                </button>
                <h1><i class="fas fa-heart"></i> Ø´Ø§Øª Ø§Ù„Ø­Ø¨</h1>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">â¤ï¸</div>
                <span id="userName">Ø­Ø¨ÙŠØ¨ÙŠ/Ø­Ø¨ÙŠØ¨ØªÙŠ</span>
                <button id="logoutBtn" class="action-btn" style="background-color: transparent; color: white; box-shadow: none;">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
        <div class="chat-container">
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
            <div class="users-sidebar" id="usersSidebar">
                <div class="users-header">
                    <i class="fas fa-heart"></i> Ø§Ù„Ø£Ø­Ø¨Ø© Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†
                </div>
                <div class="users-list" id="usersList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                </div>
            </div>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            <div class="messages-area">
                <div class="messages-header">
                    <span>Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø¨ ğŸ’•</span>
                    <span id="onlineCount">2 Ù…ØªØµÙ„ÙˆÙ†</span>
                </div>
                
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...">
                    <button class="action-btn" id="searchBtn" style="width: 40px; height: 40px;">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                </div>
                <div class="typing-indicator hidden" id="typingIndicator"></div>
                
                <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ -->
                <div class="emoji-picker" id="emojiPicker">
                    <div class="emoji-category">
                        <h4><i class="fas fa-heart"></i> Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ</h4>
                        <div class="emoji-grid">
                            <div class="emoji">ğŸ’–</div>
                            <div class="emoji">ğŸ’•</div>
                            <div class="emoji">ğŸ’—</div>
                            <div class="emoji">ğŸ’“</div>
                            <div class="emoji">ğŸ’</div>
                            <div class="emoji">ğŸ’˜</div>
                            <div class="emoji">â¤ï¸</div>
                            <div class="emoji">ğŸ§¡</div>
                            <div class="emoji">ğŸ’›</div>
                            <div class="emoji">ğŸ’š</div>
                            <div class="emoji">ğŸ’™</div>
                            <div class="emoji">ğŸ’œ</div>
                            <div class="emoji">ğŸ¤</div>
                            <div class="emoji">ğŸ–¤</div>
                            <div class="emoji">ğŸ¤</div>
                            <div class="emoji">ğŸ’‹</div>
                            <div class="emoji">ğŸ˜˜</div>
                            <div class="emoji">ğŸ¥°</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">â¤ï¸â€ğŸ”¥</div>
                            <div class="emoji">â¤ï¸â€ğŸ©¹</div>
                            <div class="emoji">ğŸ’</div>
                            <div class="emoji">ğŸŒ¹</div>
                            <div class="emoji">ğŸ¥€</div>
                        </div>
                    </div>
                    <div class="emoji-category">
                        <h4><i class="fas fa-smile"></i> Ù…Ø´Ø§Ø¹Ø±</h4>
                        <div class="emoji-grid">
                            <div class="emoji">ğŸ˜Š</div>
                            <div class="emoji">ğŸ˜‡</div>
                            <div class="emoji">ğŸ™‚</div>
                            <div class="emoji">ğŸ™ƒ</div>
                            <div class="emoji">ğŸ˜‰</div>
                            <div class="emoji">ğŸ˜Œ</div>
                            <div class="emoji">ğŸ˜‹</div>
                            <div class="emoji">ğŸ˜›</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">ğŸ˜œ</div>
                            <div class="emoji">ğŸ¤ª</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">ğŸ¤©</div>
                            <div class="emoji">ğŸ¥³</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">ğŸ˜’</div>
                            <div class="emoji">ğŸ˜”</div>
                            <div class="emoji">ğŸ˜¢</div>
                            <div class="emoji">ğŸ˜­</div>
                            <div class="emoji">ğŸ˜¡</div>
                            <div class="emoji">ğŸ¥º</div>
                            <div class="emoji">ğŸ¤—</div>
                            <div class="emoji">ğŸ¤­</div>
                            <div class="emoji">ğŸ«£</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ù…ÙƒØªØ¨Ø© GIF -->
                <div class="gif-picker" id="gifPicker">
                    <div class="gif-search">
                        <input type="text" class="gif-search-input" id="gifSearchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† GIF Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ...">
                    </div>
                    <div class="gif-category">
                        <h4><i class="fas fa-heart"></i> Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ</h4>
                        <div class="gif-grid" id="gifGrid">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù€ GIFs Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                        </div>
                    </div>
                </div>
                
                <!-- Ø­Ø§ÙˆÙŠØ© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª -->
                <div class="file-upload-container" id="fileUploadContainer">
                    <button class="upload-option" onclick="openFilePicker('image')">
                        <i class="fas fa-image"></i> ØµÙˆØ±Ø©
                    </button>
                    <button class="upload-option" onclick="openFilePicker('video')">
                        <i class="fas fa-video"></i> ÙÙŠØ¯ÙŠÙˆ
                    </button>
                    <button class="upload-option" onclick="openFilePicker('file')">
                        <i class="fas fa-file"></i> Ù…Ù„Ù
                    </button>
                    <div class="upload-progress" id="uploadProgress">
                        <div class="upload-progress-bar" id="uploadProgressBar"></div>
                    </div>
                </div>

                <!-- Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø®ÙÙŠØ© -->
                <input type="file" id="imageInput" class="file-input" accept="image/*" multiple>
                <input type="file" id="videoInput" class="file-input" accept="video/*">
                <input type="file" id="fileInput" class="file-input" accept="*/*">

                <!-- Ø­Ø§ÙˆÙŠØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„ÙØ§Øª -->
                <div class="preview-container" id="previewContainer">
                    <div class="preview-content">
                        <button class="close-preview" id="closePreview">
                            <i class="fas fa-times"></i>
                        </button>
                        <img class="preview-image" id="previewImage" style="display: none;">
                        <video class="preview-video" id="previewVideo" controls style="display: none;"></video>
                        <div class="preview-actions">
                            <button class="action-btn" id="sendFileBtn" style="display: none;">
                                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                            </button>
                            <button class="action-btn" id="cancelFileBtn" style="background: #6c757d;">
                                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="input-area">
                    <button class="action-btn" id="attachBtn">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="gif-btn" id="gifBtn">
                        <i class="fas fa-film"></i>
                    </button>
                    <button class="emoji-btn" id="emojiBtn">
                        <i class="fas fa-smile"></i>
                    </button>
                    <input type="text" class="message-input" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø­Ø¨...">
                    <button class="action-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="action-btn" id="kissBtn" style="background: #ff6b95;">
                        <i class="fas fa-kiss-wink-heart"></i>
                    </button>
                    <button class="action-btn" id="heartbeatBtn" style="background: #ff4757;">
                        <i class="fas fa-heartbeat"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary
        const CLOUDINARY_CLOUD_NAME = 'dopzq8owd';
        const CLOUDINARY_UPLOAD_PRESET = 'lover_chat';

        // ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDy9jmys9AcELdM7mdpySolC7JDyWr8nY0",
            authDomain: "lover-chat-523fa.firebaseapp.com",
            databaseURL: "https://lover-chat-523fa-default-rtdb.firebaseio.com",
            projectId: "lover-chat-523fa",
            storageBucket: "lover-chat-523fa.firebasestorage.app",
            messagingSenderId: "377312103297",
            appId: "1:377312103297:web:8b23979517c3b69d34f680",
            measurementId: "G-N42BMX8SGJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ğŸ”Š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØµÙˆØ§Øª - Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯
        const soundLibrary = {
            send: 'send.mp3',
            kiss: 'kiss.mp3',
            heartbeat: 'heartbeat.mp3',
            emoji: 'emoji.mp3',
            reaction: 'reaction.mp3',
            magic: 'magic.mp3',
            notification: 'notification.mp3'
        };

        // ğŸ‘¥ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const mockUsers = {
            user1: {
                id: 'user1',
                name: 'Ø£Ø­Ù…Ø¯',
                email: 'ahmed@example.com',
                avatar: 'â¤ï¸'
            },
            user2: {
                id: 'user2',
                name: 'Ø³Ø§Ø±Ø©',
                email: 'sara@example.com',
                avatar: 'ğŸ’•'
            }
        };

        // ğŸ’¾ ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        let messages = [];
        let users = [];
        let currentUser = null;
        let currentFileToUpload = null;
        let currentFileType = null;
        let typingUsers = [];
        let audioEnabled = false;

        // ğŸ”Š Ù…Ø´ØºÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
        function playSound(soundName) {
            if (!audioEnabled) return;
            
            const soundPath = soundLibrary[soundName];
            if (soundPath) {
                const audio = new Audio(soundPath);
                audio.volume = 0.7;
                audio.play().catch(e => console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e));
            }
        }

        // ğŸ”— Ø¹Ù†Ø§ØµØ± DOM
        const authScreen = document.getElementById('authScreen');
        const chatApp = document.getElementById('chatApp');
        const loginUser1 = document.getElementById('loginUser1');
        const loginUser2 = document.getElementById('loginUser2');
        const logoutBtn = document.getElementById('logoutBtn');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const usersList = document.getElementById('usersList');
        const usersSidebar = document.getElementById('usersSidebar');
        const mobileUsersToggle = document.getElementById('mobileUsersToggle');
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const attachBtn = document.getElementById('attachBtn');
        const emojiBtn = document.getElementById('emojiBtn');
        const gifBtn = document.getElementById('gifBtn');
        const emojiPicker = document.getElementById('emojiPicker');
        const gifPicker = document.getElementById('gifPicker');
        const gifSearchInput = document.getElementById('gifSearchInput');
        const gifGrid = document.getElementById('gifGrid');
        const onlineCount = document.getElementById('onlineCount');
        const typingIndicator = document.getElementById('typingIndicator');
        const notification = document.getElementById('notification');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const themeBtn = document.getElementById('themeBtn');
        const themeOptions = document.getElementById('themeOptions');
        const emojiRain = document.getElementById('emojiRain');
        const kissBtn = document.getElementById('kissBtn');
        const heartbeatBtn = document.getElementById('heartbeatBtn');

        // ğŸ“ Ø¹Ù†Ø§ØµØ± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        const fileUploadContainer = document.getElementById('fileUploadContainer');
        const imageInput = document.getElementById('imageInput');
        const videoInput = document.getElementById('videoInput');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const previewVideo = document.getElementById('previewVideo');
        const closePreview = document.getElementById('closePreview');
        const sendFileBtn = document.getElementById('sendFileBtn');
        const cancelFileBtn = document.getElementById('cancelFileBtn');
        const uploadProgress = document.getElementById('uploadProgress');
        const uploadProgressBar = document.getElementById('uploadProgressBar');

        // ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
        function enableAudio() {
            if (!audioEnabled) {
                audioEnabled = true;
                showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸµ');
            }
        }

        document.addEventListener('click', enableAudio);
        document.addEventListener('touchstart', enableAudio);

        // ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­
        loginUser1.addEventListener('click', function() {
            enableAudio();
            loginUser(mockUsers.user1);
        });

        loginUser2.addEventListener('click', function() {
            enableAudio();
            loginUser(mockUsers.user2);
        });

        // ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        logoutBtn.addEventListener('click', function() {
            if (currentUser) {
                db.collection('users').doc(currentUser.id).update({
                    isOnline: false,
                    lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            
            currentUser = null;
            chatApp.classList.add('hidden');
            authScreen.classList.remove('hidden');
        });

        // ğŸ“± ØªØ¨Ø¯ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        mobileUsersToggle.addEventListener('click', function() {
            usersSidebar.classList.toggle('active');
        });

        // ğŸ‘¤ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function loginUser(user) {
            currentUser = user;
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firebase
            db.collection('users').doc(user.id).set({
                name: user.name,
                avatar: user.avatar,
                isOnline: true,
                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
            
            authScreen.classList.add('hidden');
            chatApp.classList.remove('hidden');
            
            userAvatar.textContent = user.avatar;
            userName.textContent = user.name;
            
            loadMessages();
            loadUsers();
            setupRealtimeListeners();
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© playSound('join') Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ØºÙ†ÙŠØ© Ø§Ù„Ù…Ø²Ø¹Ø¬Ø©
        }

        // ğŸ“¡ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
        function setupRealtimeListeners() {
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            db.collection('messages')
                .orderBy('timestamp', 'asc')
                .onSnapshot(function(snapshot) {
                    messages = [];
                    snapshot.forEach(function(doc) {
                        messages.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    loadMessages();
                });

            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            db.collection('users')
                .onSnapshot(function(snapshot) {
                    users = [];
                    snapshot.forEach(function(doc) {
                        users.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    loadUsers();
                });
        }

        // ğŸ“¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function loadMessages() {
            messagesContainer.innerHTML = '';
            
            messages
                .sort(function(a, b) { return a.timestamp - b.timestamp; })
                .forEach(function(message) {
                    displayMessage(message);
                });
            scrollToBottom();
        }

        // ğŸ’¬ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        function displayMessage(message, isSearchResult = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.senderId === currentUser.id ? 'user' : 'other'}`;
            messageDiv.dataset.id = message.id;
            
            let messageText = message.text;
            
            let messageContent = `
                <div class="message-header">
                    <span>${message.senderName}</span>
                    <span>${formatTime(message.timestamp?.toDate())}</span>
                </div>
            `;
            
            if (message.replyTo) {
                messageContent += `
                    <div class="reply-indicator">
                        Ø±Ø¯ Ø¹Ù„Ù‰: ${message.replyTo.text.substring(0, 50)}${message.replyTo.text.length > 50 ? '...' : ''}
                    </div>
                `;
            }
            
            messageContent += `<div class="message-text">${messageText}</div>`;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
            if (message.fileUrl) {
                if (message.fileType === 'image') {
                    messageContent += `
                        <div class="file-attachment">
                            <img src="${message.fileUrl}" alt="ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©" onclick="previewFile('${message.fileUrl}', 'image')">
                            <div style="font-size: 0.8rem; margin-top: 5px;">${message.fileName || 'ØµÙˆØ±Ø©'}</div>
                        </div>
                    `;
                } else if (message.fileType === 'video') {
                    messageContent += `
                        <div class="file-attachment">
                            <video controls style="max-width: 250px; border-radius: 8px;" onclick="previewFile('${message.fileUrl}', 'video')">
                                <source src="${message.fileUrl}" type="video/mp4">
                                Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                            </video>
                            <div style="font-size: 0.8rem; margin-top: 5px;">${message.fileName || 'ÙÙŠØ¯ÙŠÙˆ'}</div>
                        </div>
                    `;
                } else {
                    messageContent += `
                        <div class="file-attachment">
                            <i class="fas fa-file"></i>
                            <a href="${message.fileUrl}" target="_blank" download="${message.fileName}">
                                ${message.fileName || 'Ù…Ù„Ù Ù…Ø±ÙÙ‚'}
                            </a>
                        </div>
                    `;
                }
            }
            
            if (message.gifUrl) {
                messageContent += `
                    <div class="gif-attachment">
                        <img src="${message.gifUrl}" alt="GIF">
                    </div>
                `;
            }
            
            // ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
            if (message.reactions && Object.keys(message.reactions).length > 0) {
                messageContent += `<div class="message-reactions">`;
                for (const [emoji, users] of Object.entries(message.reactions)) {
                    messageContent += `
                        <div class="reaction" onclick="addReaction('${message.id}', '${emoji}')">
                            <span>${emoji}</span>
                            <span class="reaction-count">${users.length}</span>
                        </div>
                    `;
                }
                messageContent += `</div>`;
            }
            
            messageContent += `
                <div class="message-actions">
                    <span class="message-action" onclick="showReactionPicker('${message.id}')">
                        <i class="fas fa-heart"></i>
                    </span>
                    <span class="message-action" onclick="replyToMessage('${message.id}')">
                        <i class="fas fa-reply"></i>
                    </span>
                    ${message.senderId === currentUser.id ? `
                        <span class="message-action" onclick="editMessage('${message.id}')">
                            <i class="fas fa-edit"></i>
                        </span>
                        <span class="message-action" onclick="deleteMessage('${message.id}')">
                            <i class="fas fa-trash"></i>
                        </span>
                    ` : ''}
                </div>
            `;
            
            messageDiv.innerHTML = messageContent;
            messagesContainer.appendChild(messageDiv);
            
            // Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
            const reactionPicker = document.createElement('div');
            reactionPicker.className = 'reaction-picker';
            reactionPicker.id = `reaction-picker-${message.id}`;
            reactionPicker.innerHTML = `
                <span class="reaction-option" onclick="addReaction('${message.id}', 'ğŸ’–')">ğŸ’–</span>
                <span class="reaction-option" onclick="addReaction('${message.id}', 'â¤ï¸')">â¤ï¸</span>
                <span class="reaction-option" onclick="addReaction('${message.id}', 'ğŸ˜˜')">ğŸ˜˜</span>
                <span class="reaction-option" onclick="addReaction('${message.id}', 'ğŸ¥°')">ğŸ¥°</span>
                <span class="reaction-option" onclick="addReaction('${message.id}', 'ğŸŒ¹')">ğŸŒ¹</span>
                <span class="reaction-option" onclick="addReaction('${message.id}', 'ğŸ’•')">ğŸ’•</span>
            `;
            messageDiv.appendChild(reactionPicker);
        }

        // ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«
        function sendMessage() {
            const text = messageInput.value.trim();
            if (text === '') return;
            
            db.collection('messages').add({
                text: text,
                senderId: currentUser.id,
                senderName: currentUser.name,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                reactions: {}
            });
            
            messageInput.value = '';
            createBubbles(3);
            
            const emojiMatches = text.match(/\p{Emoji}/gu);
            
            if (emojiMatches) {
                // Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ: emoji ÙÙ‚Ø· + Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ø·Ø§Ø¦Ø±Ø©
                playSound('emoji');
                setTimeout(function() {
                    createFloatingEmojis(emojiMatches, 15);
                }, 300);
            } else {
                // Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ©: send ÙÙ‚Ø·
                playSound('send');
            }
            
            if (text.includes('Ø­Ø¨') || text.includes('Ø­Ø¨ÙŠ') || text.includes('Ø¹Ø´Ù‚') || text.includes('Ù‚Ù„Ø¨ÙŠ')) {
                createHearts(5);
            }
        }

        // â˜ï¸ Ø±ÙØ¹ Ù…Ù„Ù Ø¥Ù„Ù‰ Cloudinary
        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            
            try {
                uploadProgress.style.display = 'block';
                uploadProgressBar.style.width = '30%';

                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`, {
                    method: 'POST',
                    body: formData
                });

                uploadProgressBar.style.width = '70%';

                const data = await response.json();
                
                uploadProgressBar.style.width = '100%';
                
                if (data.secure_url) {
                    showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!');
                    return data.secure_url;
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù:', error);
                showNotification('âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù');
                return null;
            } finally {
                setTimeout(function() {
                    uploadProgress.style.display = 'none';
                    uploadProgressBar.style.width = '0%';
                }, 1000);
            }
        }

        // ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ù
        sendFileBtn.addEventListener('click', async function() {
            if (!currentFileToUpload) return;

            const fileUrl = await uploadToCloudinary(currentFileToUpload);

            if (fileUrl) {
                await db.collection('messages').add({
                    text: '',
                    senderId: currentUser.id,
                    senderName: currentUser.name,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    fileUrl: fileUrl,
                    fileType: currentFileType,
                    fileName: currentFileToUpload.name,
                    reactions: {}
                });

                closeFilePreview();
                showNotification('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!');
                playSound('send'); // ØµÙˆØª send Ù„Ù„Ù…Ù„ÙØ§Øª ÙÙ‚Ø·
                createBubbles(2);
            }
        });

        // ğŸ‘¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function loadUsers() {
            usersList.innerHTML = '';
            let onlineUsers = 0;
            
            users.forEach(function(user) {
                if (user.id !== currentUser.id) {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    
                    const lastSeen = user.lastSeen ? user.lastSeen.toDate() : new Date();
                    const isOnline = user.isOnline && (new Date() - lastSeen < 300000);
                    
                    userItem.innerHTML = `
                        <div class="user-status ${isOnline ? '' : 'offline'}"></div>
                        <div class="user-avatar">${user.avatar}</div>
                        <div class="user-details">
                            <div class="user-name">${user.name}</div>
                            <div class="user-status-text">${isOnline ? 'Ù…ØªØµÙ„/Ø©' : 'ØºÙŠØ± Ù…ØªØµÙ„/Ø©'}</div>
                        </div>
                    `;
                    usersList.appendChild(userItem);
                }
                
                if (user.isOnline) onlineUsers++;
            });
            
            onlineCount.textContent = `${onlineUsers} Ù…ØªØµÙ„ÙˆÙ†`;
        }

        // â° ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
        function formatTime(timestamp) {
            if (!timestamp) return '';
            return timestamp.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
        }

        // ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(text) {
            notification.textContent = text;
            notification.style.display = 'block';
            setTimeout(function() {
                notification.style.display = 'none';
            }, 3000);
        }

        // âœ¨ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
        function createFloatingEmojis(emojis, count) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© playSound('magic') Ù…Ù† Ù‡Ù†Ø§ - Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ±
            for (let i = 0; i < count; i++) {
                setTimeout(function() {
                    const emoji = document.createElement('div');
                    emoji.className = 'floating-emoji';
                    emoji.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.left = Math.random() * 100 + 'vw';
                    emoji.style.top = '-50px';
                    emoji.style.fontSize = (Math.random() * 15 + 30) + 'px';
                    emoji.style.animationDuration = (Math.random() * 2 + 4) + 's';
                    document.body.appendChild(emoji);
                    
                    setTimeout(function() {
                        if (emoji.parentNode) {
                            emoji.remove();
                        }
                    }, 6000);
                }, i * 200);
            }
        }

        function createHearts(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(function() {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.innerHTML = 'ğŸ’–';
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    document.body.appendChild(heart);
                    
                    setTimeout(function() {
                        if (heart.parentNode) {
                            heart.remove();
                        }
                    }, 3000);
                }, i * 200);
            }
        }

        function createBubbles(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(function() {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    bubble.style.left = Math.random() * 100 + 'vw';
                    bubble.style.top = '80vh';
                    bubble.style.width = bubble.style.height = (Math.random() * 50 + 20) + 'px';
                    document.body.appendChild(bubble);
                    
                    setTimeout(function() {
                        if (bubble.parentNode) {
                            bubble.remove();
                        }
                    }, 2000);
                }, i * 100);
            }
        }

        // ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
        function openFilePicker(type) {
            fileUploadContainer.style.display = 'none';
            
            switch(type) {
                case 'image':
                    imageInput.click();
                    break;
                case 'video':
                    videoInput.click();
                    break;
                case 'file':
                    fileInput.click();
                    break;
            }
        }

        imageInput.addEventListener('change', function(e) {
            const files = e.target.files;
            if (files.length > 0) {
                if (files.length === 1) {
                    showPreview(files[0], 'image');
                } else {
                    uploadMultipleFiles(files, 'image');
                }
            }
        });

        videoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                showPreview(file, 'video');
            }
        });

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                showPreview(file, 'file');
            }
        });

        function showPreview(file, type) {
            currentFileToUpload = file;
            currentFileType = type;

            const reader = new FileReader();
            
            reader.onload = function(e) {
                if (type === 'image') {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                    previewVideo.style.display = 'none';
                } else if (type === 'video') {
                    previewVideo.src = e.target.result;
                    previewVideo.style.display = 'block';
                    previewImage.style.display = 'none';
                } else {
                    previewImage.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23e91e63"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><text x="12" y="18" text-anchor="middle" font-size="8" fill="white">' + getFileExtension(file.name) + '</text></svg>';
                    previewImage.style.display = 'block';
                    previewVideo.style.display = 'none';
                }
                
                sendFileBtn.style.display = 'block';
                previewContainer.style.display = 'flex';
            };
            
            reader.readAsDataURL(file);
        }

        function getFileExtension(filename) {
            return filename.split('.').pop().toUpperCase();
        }

        function closeFilePreview() {
            previewContainer.style.display = 'none';
            currentFileToUpload = null;
            currentFileType = null;
            imageInput.value = '';
            videoInput.value = '';
            fileInput.value = '';
        }

        async function uploadMultipleFiles(files, type) {
            showNotification(`ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ${files.length} Ù…Ù„Ù...`);
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileUrl = await uploadToCloudinary(file);
                if (fileUrl) {
                    await db.collection('messages').add({
                        text: '',
                        senderId: currentUser.id,
                        senderName: currentUser.name,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        fileUrl: fileUrl,
                        fileType: type,
                        fileName: file.name,
                        reactions: {}
                    });
                }
            }
            
            showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function previewFile(fileUrl, fileType) {
            if (fileType === 'image') {
                previewImage.src = fileUrl;
                previewImage.style.display = 'block';
                previewVideo.style.display = 'none';
            } else if (fileType === 'video') {
                previewVideo.src = fileUrl;
                previewVideo.style.display = 'block';
                previewImage.style.display = 'none';
            }
            
            sendFileBtn.style.display = 'none';
            previewContainer.style.display = 'flex';
        }

        // ğŸ”¼ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„
        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // â¤ï¸ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
        function addReaction(messageId, emoji) {
            const messageRef = db.collection('messages').doc(messageId);
            
            db.runTransaction(async function(transaction) {
                const messageDoc = await transaction.get(messageRef);
                if (!messageDoc.exists) return;
                
                const messageData = messageDoc.data();
                const reactions = messageData.reactions || {};
                
                if (!reactions[emoji]) {
                    reactions[emoji] = [];
                }
                
                const userIndex = reactions[emoji].indexOf(currentUser.id);
                if (userIndex > -1) {
                    reactions[emoji].splice(userIndex, 1);
                    if (reactions[emoji].length === 0) {
                        delete reactions[emoji];
                    }
                } else {
                    reactions[emoji].push(currentUser.id);
                }
                
                transaction.update(messageRef, { reactions });
            }).then(function() {
                playSound('reaction');
                setTimeout(function() {
                    playSound('magic');
                    createFloatingEmojis([emoji], 8);
                }, 300);
                
                const reactionPicker = document.getElementById(`reaction-picker-${messageId}`);
                if (reactionPicker) {
                    reactionPicker.style.display = 'none';
                }
            });
        }

        function showReactionPicker(messageId) {
            document.querySelectorAll('.reaction-picker').forEach(function(picker) {
                picker.style.display = 'none';
            });
            
            const reactionPicker = document.getElementById(`reaction-picker-${messageId}`);
            if (reactionPicker) {
                reactionPicker.style.display = 'flex';
            }
        }

        // ğŸ—‘ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function deleteMessage(messageId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) {
                db.collection('messages').doc(messageId).delete();
            }
        }

        function editMessage(messageId) {
            const message = messages.find(function(m) { return m.id === messageId; });
            if (message) {
                const newText = prompt('Ø¹Ø¯Ù„ Ø±Ø³Ø§Ù„ØªÙƒ:', message.text);
                if (newText !== null && newText.trim() !== '') {
                    db.collection('messages').doc(messageId).update({
                        text: newText
                    });
                }
            }
        }

        function replyToMessage(messageId) {
            const message = messages.find(function(m) { return m.id === messageId; });
            if (message) {
                messageInput.value = `Ø±Ø¯ Ø¹Ù„Ù‰ ${message.senderName}: ${message.text.substring(0, 30)}... `;
                messageInput.focus();
            }
        }

        // ğŸ¨ Ø§Ù„Ø«ÙŠÙ…Ø§Øª
        themeBtn.addEventListener('click', function() {
            themeOptions.style.display = themeOptions.style.display === 'flex' ? 'none' : 'flex';
        });

        document.querySelectorAll('.theme-option').forEach(function(option) {
            option.addEventListener('click', function() {
                const theme = option.dataset.theme;
                applyTheme(theme);
                themeOptions.style.display = 'none';
                showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… ${option.textContent}`);
            });
        });

        function applyTheme(theme) {
            document.documentElement.style.setProperty('--primary-color', '#e91e63');
            document.documentElement.style.setProperty('--secondary-color', '#c2185b');
            document.documentElement.style.setProperty('--accent-color', '#f8bbd9');
            document.documentElement.style.setProperty('--light-color', '#fce4ec');
            document.documentElement.style.setProperty('--dark-color', '#880e4f');
            document.documentElement.style.setProperty('--bg-color', '#fff5f8');
            document.documentElement.style.setProperty('--chat-bg', '#ffffff');
            document.documentElement.style.setProperty('--user-message', '#e91e63');
            document.documentElement.style.setProperty('--other-message', '#f8bbd9');
            document.documentElement.style.setProperty('--gradient', 'linear-gradient(135deg, #e91e63, #f8bbd9)');

            if (theme === 'classic') {
                document.documentElement.style.setProperty('--primary-color', '#d81b60');
                document.documentElement.style.setProperty('--secondary-color', '#ad1457');
                document.documentElement.style.setProperty('--accent-color', '#f48fb1');
                document.documentElement.style.setProperty('--gradient', 'linear-gradient(135deg, #d81b60, #f48fb1)');
            } else if (theme === 'elegant') {
                document.documentElement.style.setProperty('--primary-color', '#c2185b');
                document.documentElement.style.setProperty('--secondary-color', '#880e4f');
                document.documentElement.style.setProperty('--accent-color', '#f8bbd9');
                document.documentElement.style.setProperty('--gradient', 'linear-gradient(135deg, #c2185b, #f8bbd9)');
            }
        }

        // ğŸ” Ø§Ù„Ø¨Ø­Ø«
        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        function performSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            if (searchTerm === '') {
                loadMessages();
                return;
            }

            const filteredMessages = messages.filter(function(message) { 
                return message.text.toLowerCase().includes(searchTerm);
            });

            if (filteredMessages.length === 0) {
                showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬');
                return;
            }

            messagesContainer.innerHTML = '';
            filteredMessages.forEach(function(message) {
                displayMessage(message, true);
            });

            if (filteredMessages.length > 0) {
                const firstMessage = document.querySelector('.message');
                if (firstMessage) {
                    firstMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstMessage.classList.add('highlighted');
                    
                    setTimeout(function() {
                        firstMessage.classList.remove('highlighted');
                    }, 3000);
                }
            }
        }

        // ğŸ“Œ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«
        document.querySelectorAll('.emoji').forEach(function(emojiElement) {
            emojiElement.addEventListener('click', function() {
                messageInput.value += emojiElement.textContent;
                messageInput.focus();
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© playSound('emoji') Ùˆ createFloatingEmojis Ù…Ù† Ù‡Ù†Ø§
            });
        });

        // ğŸ’‹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®Ø§ØµØ© - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«
        kissBtn.addEventListener('click', function() {
            playSound('kiss');
            setTimeout(function() {
                playSound('magic');
                createFloatingEmojis(['ğŸ’‹', 'ğŸ˜˜', 'ğŸ’‹'], 10);
            }, 500);
            showNotification('ğŸ’‹ Ù‚Ø¨Ù„Ø© Ø­Ø§Ø±Ø©!');
        });

        heartbeatBtn.addEventListener('click', function() {
            playSound('heartbeat');
            setTimeout(function() {
                playSound('magic');
                createHearts(8);
            }, 500);
            showNotification('ğŸ’“ Ø¯Ù‚Ø§Øª Ù‚Ù„Ø¨ÙŠ Ù„Ùƒ!');
        });

        // ğŸ¬ Ù…ÙƒØªØ¨Ø© GIF
        gifBtn.addEventListener('click', function() {
            gifPicker.style.display = gifPicker.style.display === 'block' ? 'none' : 'block';
            emojiPicker.style.display = 'none';
            fileUploadContainer.style.display = 'none';
            loadRomanticGifs();
        });

        function loadRomanticGifs(searchTerm = 'romance') {
            const romanticGifs = [
                'https://media.giphy.com/media/l0HlRnAWXxn0MhKLK/giphy.gif',
                'https://media.giphy.com/media/3o7aD2d7hy9ktXNDP2/giphy.gif',
                'https://media.giphy.com/media/l41lZ2sJreWUvX3UY/giphy.gif',
                'https://media.giphy.com/media/3o72FfM5HJydzafgUE/giphy.gif',
                'https://media.giphy.com/media/l4FGI8GoTL7N4DsyI/giphy.gif',
                'https://media.giphy.com/media/3o7aCTPPm4OHfRLSH6/giphy.gif'
            ];
            
            gifGrid.innerHTML = '';
            romanticGifs.forEach(function(gifUrl) {
                const gifItem = document.createElement('div');
                gifItem.className = 'gif-item';
                gifItem.innerHTML = `<img src="${gifUrl}" alt="GIF Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ">`;
                gifItem.addEventListener('click', function() { sendGif(gifUrl); });
                gifGrid.appendChild(gifItem);
            });
        }

        function sendGif(gifUrl) {
            db.collection('messages').add({
                text: '',
                senderId: currentUser.id,
                senderName: currentUser.name,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                gifUrl: gifUrl,
                reactions: {}
            });
            
            gifPicker.style.display = 'none';
            playSound('send'); // ØµÙˆØª send Ù„Ù„Ù€ GIF
            createBubbles(2);
        }

        // ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø±Ø§Øª
        document.addEventListener('click', function(e) {
            if (!emojiBtn.contains(e.target) && !emojiPicker.contains(e.target)) {
                emojiPicker.style.display = 'none';
            }
            
            if (!gifBtn.contains(e.target) && !gifPicker.contains(e.target)) {
                gifPicker.style.display = 'none';
            }
            
            if (!attachBtn.contains(e.target) && !fileUploadContainer.contains(e.target)) {
                fileUploadContainer.style.display = 'none';
            }
            
            if (!themeBtn.contains(e.target) && !themeOptions.contains(e.target)) {
                themeOptions.style.display = 'none';
            }
            
            if (!e.target.closest('.message-action') && !e.target.closest('.reaction-picker')) {
                document.querySelectorAll('.reaction-picker').forEach(function(picker) {
                    picker.style.display = 'none';
                });
            }
            
            if (window.innerWidth <= 768 && !e.target.closest('.users-sidebar') && !e.target.closest('.mobile-users-toggle')) {
                usersSidebar.classList.remove('active');
            }
        });

        // âŒ¨ï¸ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        attachBtn.addEventListener('click', function(e) {
            fileUploadContainer.style.display = fileUploadContainer.style.display === 'block' ? 'none' : 'block';
            emojiPicker.style.display = 'none';
            gifPicker.style.display = 'none';
        });

        emojiBtn.addEventListener('click', function(e) {
            emojiPicker.style.display = emojiPicker.style.display === 'block' ? 'none' : 'block';
            gifPicker.style.display = 'none';
            fileUploadContainer.style.display = 'none';
        });

        closePreview.addEventListener('click', closeFilePreview);
        cancelFileBtn.addEventListener('click', closeFilePreview);

        // ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        window.addEventListener('load', function() {
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ø¦Ù„ ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø±Ø³Ø§Ø¦Ù„
            setTimeout(function() {
                if (messages.length === 0) {
                    db.collection('messages').add({
                        text: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø´Ø§Øª Ø§Ù„Ø­Ø¨! ğŸ’–',
                        senderId: 'user1',
                        senderName: 'Ø£Ø­Ù…Ø¯',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        reactions: {}
                    });
                }
            }, 2000);
        });
    </script>
</body>
</html>