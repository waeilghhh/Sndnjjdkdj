<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoverChat - ØªØ·Ø¨ÙŠÙ‚ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ Ù„Ù„Ø£Ø²ÙˆØ§Ø¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ø¥Ø¶Ø§ÙØ© Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        :root {
            --primary-color: #e91e63;
            --secondary-color: #c2185b;
            --accent-color: #f8bbd9;
            --light-color: #fce4ec;
            --dark-color: #880e4f;
            --bg-color: #fff5f8;
            --chat-bg: #ffffff;
            --user-message: #e91e63;
            --other-message: #f8bbd9;
            --gradient: linear-gradient(135deg, #e91e63, #f8bbd9);
            --highlight-color: #fff9c4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--dark-color);
            height: 100vh;
            overflow: hidden;
            background-image: linear-gradient(rgba(255, 245, 248, 0.9), rgba(255, 245, 248, 0.9)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23e91e63" opacity="0.1" d="M50,30 C60,20 80,25 80,40 C80,55 65,60 50,70 C35,60 20,55 20,40 C20,25 40,20 50,30 Z"/></svg>');
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            margin: 0 auto;
        }

        /* Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        .header {
            background: var(--gradient);
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(233, 30, 99, 0.2);
            min-height: 60px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="50" height="50" opacity="0.1"><path fill="%23ffffff" d="M50,30 C60,20 80,25 80,40 C80,55 65,60 50,70 C35,60 20,55 20,40 C20,25 40,20 50,30 Z"/></svg>');
        }

        .header h1 {
            font-size: 1.2rem;
            font-weight: 600;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .chat-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
        .users-sidebar {
            width: 250px;
            background-color: white;
            border-left: 1px solid #ffcdd2;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            box-shadow: -2px 0 10px rgba(233, 30, 99, 0.1);
            flex-shrink: 0;
        }

        .users-header {
            padding: 12px 15px;
            background-color: var(--light-color);
            border-bottom: 1px solid #ffcdd2;
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .users-list {
            flex: 1;
            overflow-y: auto;
        }

        .user-item {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #fce4ec;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .user-item:hover {
            background-color: #fce4ec;
        }

        .user-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4caf50;
        }

        .user-status.offline {
            background-color: #9e9e9e;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .messages-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--chat-bg);
            position: relative;
            min-width: 0;
        }

        .messages-header {
            padding: 12px 15px;
            background-color: white;
            border-bottom: 1px solid #ffcdd2;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: var(--dark-color);
            flex-shrink: 0;
        }

        .search-container {
            padding: 10px 15px;
            background-color: white;
            border-bottom: 1px solid #ffcdd2;
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .search-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ffcdd2;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
        }

        .search-input:focus {
            border-color: var(--primary-color);
        }

        .messages-container {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: var(--bg-color);
        }

        .message {
            max-width: 85%;
            padding: 10px 12px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            font-size: 0.95rem;
            animation: messageAppear 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--user-message);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.other {
            align-self: flex-start;
            background-color: var(--other-message);
            color: var(--dark-color);
            border-bottom-left-radius: 5px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .message-actions {
            position: absolute;
            top: -8px;
            right: 8px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            padding: 4px;
        }

        .message:hover .message-actions {
            display: flex;
        }

        .message-action {
            margin: 0 4px;
            cursor: pointer;
            color: var(--dark-color);
            font-size: 0.8rem;
            transition: color 0.2s;
        }

        .message-action:hover {
            color: var(--primary-color);
        }

        .reply-indicator {
            background-color: rgba(255, 255, 255, 0.3);
            border-right: 3px solid var(--primary-color);
            padding: 6px 10px;
            border-radius: 8px;
            margin-bottom: 5px;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .file-attachment {
            margin-top: 8px;
            padding: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
        }

        .file-attachment img {
            max-width: 200px;
            border-radius: 8px;
            cursor: pointer;
        }

        .file-attachment video {
            max-width: 250px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
        .input-area {
            padding: 12px 15px;
            background-color: white;
            border-top: 1px solid #ffcdd2;
            display: flex;
            gap: 8px;
            align-items: flex-end;
            position: relative;
            flex-shrink: 0;
        }

        .message-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ffcdd2;
            border-radius: 24px;
            outline: none;
            resize: none;
            height: 45px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
            min-width: 0;
        }

        .message-input:focus {
            border-color: var(--primary-color);
        }

        .action-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gradient);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(233, 30, 99, 0.2);
            flex-shrink: 0;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(233, 30, 99, 0.3);
        }

        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù‚Ù‚ */
        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--gradient);
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100" opacity="0.1"><path fill="%23ffffff" d="M50,30 C60,20 80,25 80,40 C80,55 65,60 50,70 C35,60 20,55 20,40 C20,25 40,20 50,30 Z"/></svg>');
        }

        .auth-box {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 350px;
            position: relative;
            z-index: 1;
        }

        .auth-box h2 {
            text-align: center;
            margin-bottom: 15px;
            color: var(--dark-color);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .code-input {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 2px solid #ffcdd2;
            border-radius: 10px;
            font-size: 1.1rem;
            text-align: center;
            outline: none;
            transition: border-color 0.3s;
        }

        .code-input:focus {
            border-color: var(--primary-color);
        }

        .code-error {
            color: #f44336;
            text-align: center;
            margin: 10px 0;
            font-size: 0.9rem;
            display: none;
        }

        .quick-login {
            margin-top: 15px;
            text-align: center;
        }

        .quick-login button {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 12px;
            border-radius: 25px;
            cursor: pointer;
            margin: 4px 0;
            width: 100%;
            font-size: 0.9rem;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(233, 30, 99, 0.2);
        }

        .quick-login button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(233, 30, 99, 0.3);
        }

        .hidden {
            display: none;
        }

        /* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .users-sidebar {
                position: absolute;
                top: 60px;
                right: 0;
                bottom: 0;
                z-index: 100;
                transform: translateX(100%);
                width: 280px;
            }
            
            .users-sidebar.active {
                transform: translateX(0);
            }
            
            .message {
                max-width: 90%;
            }
            
            .emoji-picker, .file-upload-container {
                width: 300px !important;
                right: 10px !important;
                bottom: 60px !important;
            }
            
            .header h1 {
                font-size: 1.1rem;
            }

            .input-area {
                padding: 10px 12px;
                gap: 6px;
            }

            .action-btn {
                width: 40px;
                height: 40px;
                font-size: 0.8rem;
            }

            .message-input {
                height: 40px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
            }
            
            .messages-container {
                padding: 10px;
            }
            
            .input-area {
                padding: 8px 10px;
            }
            
            .message {
                max-width: 95%;
                padding: 8px 10px;
            }
            
            .emoji-picker, .file-upload-container {
                width: 280px !important;
                right: 5px !important;
            }

            .action-btn {
                width: 38px;
                height: 38px;
            }

            .users-sidebar {
                width: 100%;
            }
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .typing-indicator {
            padding: 4px 12px;
            font-style: italic;
            color: var(--dark-color);
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .message-reactions {
            display: flex;
            margin-top: 6px;
            gap: 4px;
            flex-wrap: wrap;
        }

        .reaction {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 2px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .reaction:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .reaction-count {
            font-size: 0.65rem;
        }

        .reaction-picker {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            padding: 6px;
            display: none;
            z-index: 100;
        }

        .reaction-option {
            font-size: 1.3rem;
            padding: 4px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .reaction-option:hover {
            transform: scale(1.2);
        }

        /* Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .emoji-btn {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 4px;
            color: var(--primary-color);
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .emoji-btn:hover {
            transform: scale(1.1);
        }

        .emoji-picker {
            position: absolute;
            bottom: 60px;
            right: 15px;
            width: 320px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            padding: 12px;
            z-index: 1000;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .emoji-category {
            margin-bottom: 8px;
        }

        .emoji-category h4 {
            margin-bottom: 6px;
            color: var(--dark-color);
            border-bottom: 1px solid #ffcdd2;
            padding-bottom: 4px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
        }

        .emoji {
            font-size: 1.3rem;
            cursor: pointer;
            text-align: center;
            padding: 4px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .emoji:hover {
            background-color: #fce4ec;
        }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--gradient);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            display: none;
            font-size: 0.85rem;
            max-width: 300px;
        }

        /* Ø²Ø± Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .mobile-users-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .mobile-users-toggle {
                display: block;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù‚Ù„ÙˆØ¨ ÙˆØ§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .floating-emoji {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            font-size: 2.5rem;
            animation: floatDown 6s ease-in-out forwards;
            user-select: none;
            opacity: 1;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
            filter: drop-shadow(0 0 5px rgba(233, 30, 99, 0.3));
        }

        @keyframes floatDown {
            0% {
                transform: translateY(-100px) scale(0.8) rotate(0deg);
                opacity: 1;
            }
            70% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) scale(1.2) rotate(360deg);
                opacity: 0;
            }
        }

        .emoji-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .emoji-drop {
            position: absolute;
            font-size: 2rem;
            animation: emojiRainFall 5s linear forwards;
            user-select: none;
            opacity: 1;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            filter: drop-shadow(0 0 3px rgba(233, 30, 99, 0.4));
        }

        @keyframes emojiRainFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            80% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .heart {
            position: absolute;
            pointer-events: none;
            opacity: 0.8;
            animation: float 3s ease-in-out forwards;
        }

        @keyframes float {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(0.5);
                opacity: 0;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª */
        .bubble {
            position: absolute;
            background: rgba(233, 30, 99, 0.1);
            border-radius: 50%;
            pointer-events: none;
            animation: bubble 2s ease-in-out forwards;
        }

        @keyframes bubble {
            0% {
                transform: scale(0);
                opacity: 0.8;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Ø®Ù„ÙÙŠØ© Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© */
        .romantic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(233, 30, 99, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(248, 187, 217, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(192, 24, 91, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« */
        .highlight {
            background-color: var(--highlight-color);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        .message.highlighted {
            animation: pulseHighlight 2s ease-in-out;
            border: 2px solid var(--highlight-color);
        }

        @keyframes pulseHighlight {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 249, 196, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 249, 196, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 249, 196, 0);
            }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
        .file-upload-container {
            position: absolute;
            bottom: 70px;
            right: 15px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            padding: 15px;
            z-index: 1000;
            display: none;
            min-width: 200px;
        }

        .upload-option {
            padding: 10px 15px;
            border: none;
            background: none;
            text-align: right;
            width: 100%;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--dark-color);
        }

        .upload-option:hover {
            background-color: #fce4ec;
        }

        .file-input {
            display: none;
        }

        .upload-progress {
            width: 100%;
            height: 4px;
            background-color: #f0f0f0;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
            display: none;
        }

        .upload-progress-bar {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .preview-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .preview-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .preview-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
        }

        .preview-video {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .close-preview {
            position: absolute;
            top: 10px;
            left: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        /* ================================================================ */
        /* Ø£Ù†Ù…Ø§Ø· Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ */
        /* ================================================================ */

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØµØºØ±Ø© - Ø´ÙØ§ÙØ© - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ */
        .mini-player {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 270px;
            height: 70px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #fdbb2d;
            border-radius: 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }

        .mini-player button {
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .mini-player button:hover {
            background: rgba(253, 187, 45, 0.3);
            transform: scale(1.1);
        }

        /* Ù…Ø´ØºÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ù…ØµØºØ± - Ø´ÙØ§Ù */
        .audio-mini-player {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 270px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #fdbb2d;
            border-radius: 15px;
            padding: 12px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            display: none;
            backdrop-filter: blur(10px);
        }

        .audio-mini-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .audio-mini-title {
            color: #fdbb2d;
            font-size: 14px;
            font-weight: bold;
        }

        .audio-mini-close {
            background: #ff4444;
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .audio-mini-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .audio-mini-controls button {
            background: #fdbb2d;
            color: #000;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .audio-mini-controls button:hover {
            background: #ffcc4d;
            transform: scale(1.1);
        }

        .audio-mini-volume {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .audio-mini-slider {
            width: 100px;
            height: 4px;
            border-radius: 2px;
            background: #333;
            outline: none;
        }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© - Ø´ÙØ§ÙØ© */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(26, 42, 108, 0.95);
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(253, 187, 45, 0.3);
        }

        .close-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #fdbb2d;
            color: #000;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(253, 187, 45, 0.5);
        }

        /* ØºØ±ÙØ© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© */
        .sync-room {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .room-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .room-code {
            font-size: 24px;
            font-weight: bold;
            color: #fdbb2d;
            background: rgba(253, 187, 45, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
        }

        .users-count {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .users-count::before {
            content: "ğŸ‘¥";
            font-size: 20px;
        }

        .room-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .room-controls button {
            background: #fdbb2d;
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            min-width: 160px;
        }

        .room-controls button:hover {
            background: #ffcc4d;
            transform: scale(1.05);
        }

        .room-controls button.leave {
            background: #ff4444;
            color: white;
        }

        /* ğŸ¬ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .video-player-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #000;
            z-index: 1500;
        }

        .video-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .video-title {
            color: #fdbb2d;
            font-size: 18px;
            font-weight: bold;
        }

        .video-close {
            background: #ff4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù‚Ø³Ù…Ø© */
        .split-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: auto;
        }

        /* Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø§Ù„ÙÙŠØ¯ÙŠÙˆ) */
        .top-pane {
            height: 50vh;
            min-height: 200px;
            max-height: 80vh;
            background-color: #000;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: height 0.2s ease;
        }

        .top-pane video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„ÙÙŠØ¯ÙŠÙˆ */
        .video-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            padding: 12px 15px;
            display: flex;
            gap: 20px;
            z-index: 21;
        }

        .video-controls button {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px 12px;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .video-controls button:hover {
            background: rgba(253, 187, 45, 0.3);
            transform: scale(1.1);
        }

        /* Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .video-progress-bar {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 10px;
            z-index: 20;
            display: none;
        }

        .progress-container {
            width: 100%;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 6px;
            background: #fdbb2d;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 12px;
        }

        /* Ø§Ù„Ù…Ù‚Ø¨Ø¶ Ø§Ù„ÙØ§ØµÙ„ */
        .resizer {
            background-color: #333;
            height: 8px;
            cursor: ns-resize;
            position: relative;
            z-index: 10;
            transition: background-color 0.3s ease;
            flex-shrink: 0;
        }
        .resizer:hover, .resizer:active {
            background-color: #fdbb2d;
        }

        /* Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„ÙƒØ¨ÙŠØ± - Ø´ÙØ§Ù */
        .audio-player-container {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            padding: 15px;
            z-index: 1500;
            box-shadow: 0 0 20px rgba(253, 187, 45, 0.5);
            border: 2px solid #fdbb2d;
            backdrop-filter: blur(10px);
        }

        .audio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(253, 187, 45, 0.3);
        }

        .audio-info {
            text-align: center;
            color: #fdbb2d;
            font-size: 16px;
            flex: 1;
        }

        .audio-close {
            background: #ff4444;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .audio-controls button {
            background: #fdbb2d;
            color: #000;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .audio-controls button:hover {
            background: #ffcc4d;
            transform: scale(1.1);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .volume-slider {
            width: 150px;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
        }

        /* Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø· */
        .media-library {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .media-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(253, 187, 45, 0.3);
        }

        .media-item:hover {
            background: rgba(253, 187, 45, 0.2);
            transform: translateY(-5px);
            border-color: #fdbb2d;
        }

        .media-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        .media-name {
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±ÙØ¹ */
        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .upload-input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #fdbb2d;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .upload-btn {
            background: #fdbb2d;
            color: #000;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #ffcc4d;
        }

        .upload-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„Ø© */
        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }

        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid green;
        }

        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid red;
        }

        .info {
            background: rgba(0, 0, 255, 0.2);
            border: 1px solid blue;
        }

        /* ØªØ¨ÙˆÙŠØ¨ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù */
        .file-type-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #fdbb2d;
        }

        .file-type-tab {
            padding: 10px 20px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }

        .file-type-tab.active {
            background: #fdbb2d;
            color: #000;
            font-weight: bold;
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #fdbb2d;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            .mini-player {
                width: 250px;
                height: 60px;
            }

            .mini-player button {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .audio-mini-player {
                width: 250px;
                top: 90px;
            }

            .media-library {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .room-controls button {
                min-width: 140px;
                padding: 10px 20px;
            }

            .video-controls {
                bottom: 10px;
                padding: 8px 12px;
                gap: 15px;
            }

            .video-controls button {
                font-size: 20px;
                padding: 6px 10px;
            }

            .video-progress-bar {
                bottom: 70px;
                width: 90%;
                padding: 8px;
            }

            .audio-player-container {
                width: 95%;
                padding: 12px;
            }

            .audio-controls button {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }

            .top-pane {
                min-height: 150px;
                max-height: 70vh;
            }
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø±ÙˆØ§Ø¨Ø· */
        .link-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(253, 187, 45, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .link-item:hover {
            background: rgba(253, 187, 45, 0.2);
            transform: translateY(-2px);
        }
        
        .link-platform {
            font-size: 12px;
            color: #fdbb2d;
            margin-bottom: 5px;
        }
        
        .link-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .link-url {
            font-size: 10px;
            color: #ccc;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .link-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .link-action-btn {
            background: #fdbb2d;
            color: #000;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ */
        .sync-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #fdbb2d;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 25;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Ø®Ù„ÙÙŠØ© Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© -->
    <div class="romantic-bg"></div>

    <!-- Ù…Ù†Ø·Ù‚Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ -->
    <div class="emoji-rain" id="emojiRain"></div>

    <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="notification" id="notification"></div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ -->
    <div class="sync-indicator" id="syncIndicator">ğŸ¯ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚...</div>

    <!-- Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ -->
    <div class="mini-player">
        <button id="syncBtn" title="Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©">ğŸ”„</button>
        <button id="videosBtn" title="ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª">ğŸ¬</button>
        <button id="audioLibraryBtn" title="Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØºØ§Ù†ÙŠ">ğŸ¼</button>
        <button id="audioToggleBtn" title="Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ù…ØµØºØ±">ğŸµ</button>
        <button id="uploadBtn" title="Ø±ÙØ¹ Ù…Ù„ÙØ§Øª">ğŸ“¤</button>
        <button id="linksBtn" title="ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·">ğŸ”—</button>
    </div>

    <!-- Ù…Ø´ØºÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ù…ØµØºØ± - Ø´ÙØ§Ù -->
    <div class="audio-mini-player" id="audioMiniPlayer">
        <div class="audio-mini-header">
            <div class="audio-mini-title" id="audioMiniTitle">ğŸµ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØºÙ†ÙŠØ©</div>
            <button class="audio-mini-close" onclick="mediaPlayer.hideAudioMiniPlayer()">Ã—</button>
        </div>
        <div class="audio-mini-controls">
            <button onclick="mediaPlayer.syncPlayAudio()">â–¶</button>
            <button onclick="mediaPlayer.syncPauseAudio()">â¸</button>
            <button onclick="mediaPlayer.syncSkipAudio(-10)">âª</button>
            <button onclick="mediaPlayer.syncSkipAudio(10)">â©</button>
        </div>
        <div class="audio-mini-volume">
            <span>ğŸ”Š</span>
            <input type="range" min="0" max="100" value="50" class="audio-mini-slider" id="audioMiniSlider" oninput="mediaPlayer.setAudioVolume(this.value)">
            <span id="audioMiniVolume">50%</span>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
    <div id="syncModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="mediaPlayer.closeModal('syncModal')">Ã—</button>
            <div class="modal-header">
                <h2>ğŸ¯ ØºØ±ÙØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ©</h2>
            </div>
            <div class="sync-room">
                <div class="room-info">
                    <div class="room-code">Ø§Ù„ØºØ±ÙØ©: <span id="roomCode">LOVERS_ROOM</span></div>
                    <div class="users-count"><span id="usersCount">0</span> Ù…ØªØµÙ„ÙŠÙ†</div>
                </div>
                <div class="room-controls">
                    <button onclick="mediaPlayer.joinLoversRoom()">ğŸšª Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©</button>
                    <button onclick="mediaPlayer.leaveRoom()" class="leave">ğŸ‘‹ Ù…ØºØ§Ø¯Ø±Ø©</button>
                </div>
            </div>
            <div class="status-message info">
                ğŸ’– <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong><br>
                1. Ø§Ø¶ØºØ· "Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©"<br>
                2. Ø§Ø·Ù„Ø¨ Ù…Ù† ØµØ¯ÙŠÙ‚Ùƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©"<br>
                3. Ø§Ø³ØªÙ…ØªØ¹Ø§ Ø¨Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©!
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
    <div id="videosModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="mediaPlayer.closeModal('videosModal')">Ã—</button>
            <div class="modal-header">
                <h2>Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h2>
            </div>
            <div class="media-library" id="videosLibrary">
                <div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #ccc;">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                    <div>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¨Ø¹Ø¯</div>
                    <div style="font-size: 14px; margin-top: 10px; color: #fdbb2d;">Ù‚Ù… Ø¨Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ØºØ§Ù†ÙŠ -->
    <div id="audiosModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="mediaPlayer.closeModal('audiosModal')">Ã—</button>
            <div class="modal-header">
                <h2>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØºØ§Ù†ÙŠ</h2>
            </div>
            <div class="media-library" id="audiosLibrary">
                <div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #ccc;">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸµ</div>
                    <div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØºØ§Ù†ÙŠ Ø¨Ø¹Ø¯</div>
                    <div style="font-size: 14px; margin-top: 10px; color: #fdbb2d;">Ù‚Ù… Ø¨Ø±ÙØ¹ Ø£ØºÙ†ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±ÙØ¹ -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="mediaPlayer.closeModal('uploadModal')">Ã—</button>
            <div class="modal-header">
                <h2>Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</h2>
            </div>
            
            <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù -->
            <div class="file-type-tabs">
                <div class="file-type-tab active" data-type="video">ğŸ¬ ÙÙŠØ¯ÙŠÙˆ</div>
                <div class="file-type-tab" data-type="audio">ğŸµ ØµÙˆØª</div>
            </div>
            
            <form class="upload-form" id="uploadForm">
                <input type="file" id="fileInput" class="upload-input" accept="video/*" required>
                <button type="submit" class="upload-btn" id="uploadSubmit">
                    â˜ï¸ Ø±ÙØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                </button>
            </form>
            <div id="uploadStatus" class="status-message"></div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· -->
    <div id="linksModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="mediaPlayer.closeModal('linksModal')">Ã—</button>
            <div class="modal-header">
                <h2>ğŸ¬ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø¹Ø¨Ø± Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</h2>
            </div>
            
            <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø· -->
            <div class="file-type-tabs">
                <div class="file-type-tab active" data-type="youtube">ğŸ“º ÙŠÙˆØªÙŠÙˆØ¨</div>
                <div class="file-type-tab" data-type="mediafire">ğŸ“¦ Ù…ÙŠØ¯ÙŠØ§ ÙØ§ÙŠØ±</div>
                <div class="file-type-tab" data-type="gdrive">â˜ï¸ Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ</div>
                <div class="file-type-tab" data-type="direct">ğŸ”— Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±</div>
                <div class="file-type-tab" data-type="other">ğŸŒ Ù…Ù†ØµØ§Øª Ø£Ø®Ø±Ù‰</div>
            </div>
            
            <form class="upload-form" id="linkForm">
                <input type="url" id="mediaLink" class="upload-input" placeholder="https://www.youtube.com/watch?v=..." required>
                <input type="text" id="mediaTitle" class="upload-input" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <button type="submit" class="upload-btn" id="playLinkBtn">
                    â–¶ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·
                </button>
            </form>
            
            <div id="linkStatus" class="status-message"></div>
            
            <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
            <div style="margin-top: 20px;">
                <h3 style="color: #fdbb2d; border-bottom: 1px solid #fdbb2d; padding-bottom: 8px;">ğŸ“š Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                <div id="savedLinks" style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                    <div style="text-align: center; padding: 20px; color: #ccc;">
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ¬ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
    <div class="video-player-container" id="videoPlayerContainer">
        <div class="video-header">
            <div class="video-title" id="videoTitle">ğŸ¬ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</div>
            <button class="video-close" onclick="mediaPlayer.closeVideoPlayer()">Ã—</button>
        </div>
        <div class="split-container">
            <div class="top-pane">
                <video id="videoPlayer" playsinline></video>
                <!-- Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
                <div class="video-progress-bar" id="videoProgressBar">
                    <div class="progress-container">
                        <div class="progress-bar" id="videoProgress"></div>
                        <div class="progress-text" id="videoProgressText">0%</div>
                    </div>
                </div>
                <div class="video-controls">
                    <button id="rewind-btn">Â« 10</button>
                    <button id="play-pause-btn">â–¶</button>
                    <button id="forward-btn">10 Â»</button>
                </div>
            </div>
            <div class="resizer" id="resizer"></div>
        </div>
    </div>

    <!-- Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„ÙƒØ¨ÙŠØ± - Ø´ÙØ§Ù -->
    <div class="audio-player-container" id="audioPlayerContainer">
        <div class="audio-header">
            <div class="audio-info" id="audioInfo">ğŸµ Ø§Ø®ØªØ± Ø£ØºÙ†ÙŠØ© Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø©</div>
            <button class="audio-close" onclick="mediaPlayer.closeAudioPlayer()">Ã—</button>
        </div>
        <audio id="audioPlayer"></audio>
        <div class="audio-controls">
            <button onclick="mediaPlayer.syncPlayAudio()">â–¶</button>
            <button onclick="mediaPlayer.syncPauseAudio()">â¸</button>
            <button onclick="mediaPlayer.syncSkipAudio(-10)">âª 10s</button>
            <button onclick="mediaPlayer.syncSkipAudio(10)">â© 10s</button>
        </div>
        <div class="volume-control">
            <span>ğŸ”Š</span>
            <input type="range" min="0" max="100" value="50" class="volume-slider" id="volumeSlider" oninput="mediaPlayer.setAudioVolume(this.value)">
            <span id="volumeValue">50%</span>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù‚Ù‚ -->
    <div id="authScreen" class="auth-container">
        <div class="auth-box">
            <h2><i class="fas fa-heart"></i> LoverChat</h2>
            <p style="text-align: center; margin-bottom: 15px; color: var(--dark-color); font-size: 0.9rem;">
                Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            </p>
            
            <input type="text" class="code-input" id="accessCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„" maxlength="4">
            <div class="code-error" id="codeError">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­</div>
            
            <div class="quick-login">
                <button id="verifyCode">
                    <i class="fas fa-lock"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </div>
        </div>
    </div>

    <!-- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
    <div id="chatApp" class="container hidden">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
        <div class="header">
            <div style="display: flex; align-items: center;">
                <button class="mobile-users-toggle" id="mobileUsersToggle">
                    <i class="fas fa-users"></i>
                </button>
                <h1><i class="fas fa-heart"></i> LoverChat</h1>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">â¤ï¸</div>
                <span id="userName">Ø­Ø¨ÙŠØ¨ÙŠ/Ø­Ø¨ÙŠØ¨ØªÙŠ</span>
                <button id="logoutBtn" class="action-btn" style="background-color: transparent; color: white; box-shadow: none;">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
        <div class="chat-container">
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
            <div class="users-sidebar" id="usersSidebar">
                <div class="users-header">
                    <i class="fas fa-heart"></i> Ø§Ù„Ø£Ø­Ø¨Ø© Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†
                </div>
                <div class="users-list" id="usersList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                </div>
            </div>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            <div class="messages-area">
                <div class="messages-header">
                    <span>LoverChat ğŸ’•</span>
                    <span id="onlineCount">2 Ù…ØªØµÙ„ÙˆÙ†</span>
                </div>
                
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...">
                    <button class="action-btn" id="searchBtn" style="width: 40px; height: 40px;">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                </div>
                <div class="typing-indicator hidden" id="typingIndicator"></div>
                
                <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ -->
                <div class="emoji-picker" id="emojiPicker">
                    <div class="emoji-category">
                        <h4><i class="fas fa-heart"></i> Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ</h4>
                        <div class="emoji-grid">
                            <div class="emoji">ğŸ’–</div>
                            <div class="emoji">ğŸ’•</div>
                            <div class="emoji">ğŸ’—</div>
                            <div class="emoji">ğŸ’“</div>
                            <div class="emoji">ğŸ’</div>
                            <div class="emoji">ğŸ’˜</div>
                            <div class="emoji">â¤ï¸</div>
                            <div class="emoji">ğŸ§¡</div>
                            <div class="emoji">ğŸ’›</div>
                            <div class="emoji">ğŸ’š</div>
                            <div class="emoji">ğŸ’™</div>
                            <div class="emoji">ğŸ’œ</div>
                            <div class="emoji">ğŸ¤</div>
                            <div class="emoji">ğŸ–¤</div>
                            <div class="emoji">ğŸ¤</div>
                            <div class="emoji">ğŸ’‹</div>
                            <div class="emoji">ğŸ˜˜</div>
                            <div class="emoji">ğŸ¥°</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">â¤ï¸â€ğŸ”¥</div>
                            <div class="emoji">â¤ï¸â€ğŸ©¹</div>
                            <div class="emoji">ğŸ’</div>
                            <div class="emoji">ğŸŒ¹</div>
                            <div class="emoji">ğŸ¥€</div>
                        </div>
                    </div>
                    <div class="emoji-category">
                        <h4><i class="fas fa-smile"></i> Ù…Ø´Ø§Ø¹Ø±</h4>
                        <div class="emoji-grid">
                            <div class="emoji">ğŸ˜Š</div>
                            <div class="emoji">ğŸ˜‡</div>
                            <div class="emoji">ğŸ™‚</div>
                            <div class="emoji">ğŸ™ƒ</div>
                            <div class="emoji">ğŸ˜‰</div>
                            <div class="emoji">ğŸ˜Œ</div>
                            <div class="emoji">ğŸ˜‹</div>
                            <div class="emoji">ğŸ˜›</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">ğŸ˜œ</div>
                            <div class="emoji">ğŸ¤ª</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">ğŸ¤©</div>
                            <div class="emoji">ğŸ¥³</div>
                            <div class="emoji">ğŸ˜</div>
                            <div class="emoji">ğŸ˜’</div>
                            <div class="emoji">ğŸ˜”</div>
                            <div class="emoji">ğŸ˜¢</div>
                            <div class="emoji">ğŸ˜­</div>
                            <div class="emoji">ğŸ˜¡</div>
                            <div class="emoji">ğŸ¥º</div>
                            <div class="emoji">ğŸ¤—</div>
                            <div class="emoji">ğŸ¤­</div>
                            <div class="emoji">ğŸ«£</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø­Ø§ÙˆÙŠØ© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª -->
                <div class="file-upload-container" id="fileUploadContainer">
                    <button class="upload-option" onclick="chatApp.openFilePicker('image')">
                        <i class="fas fa-image"></i> ØµÙˆØ±Ø©
                    </button>
                    <button class="upload-option" onclick="chatApp.openFilePicker('video')">
                        <i class="fas fa-video"></i> ÙÙŠØ¯ÙŠÙˆ
                    </button>
                    <button class="upload-option" onclick="chatApp.openFilePicker('file')">
                        <i class="fas fa-file"></i> Ù…Ù„Ù
                    </button>
                    <div class="upload-progress" id="uploadProgress">
                        <div class="upload-progress-bar" id="uploadProgressBar"></div>
                    </div>
                </div>

                <!-- Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø®ÙÙŠØ© -->
                <input type="file" id="imageInput" class="file-input" accept="image/*" multiple>
                <input type="file" id="videoInput" class="file-input" accept="video/*">
                <input type="file" id="fileInput" class="file-input" accept="*/*">

                <!-- Ø­Ø§ÙˆÙŠØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„ÙØ§Øª -->
                <div class="preview-container" id="previewContainer">
                    <div class="preview-content">
                        <button class="close-preview" id="closePreview">
                            <i class="fas fa-times"></i>
                        </button>
                        <img class="preview-image" id="previewImage" style="display: none;">
                        <video class="preview-video" id="previewVideo" controls style="display: none;"></video>
                        <div class="preview-actions">
                            <button class="action-btn" id="sendFileBtn" style="display: none;">
                                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                            </button>
                            <button class="action-btn" id="cancelFileBtn" style="background: #6c757d;">
                                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="input-area">
                    <button class="action-btn" id="attachBtn">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="emoji-btn" id="emojiBtn">
                        <i class="fas fa-smile"></i>
                    </button>
                    <input type="text" class="message-input" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø­Ø¨...">
                    <button class="action-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="action-btn" id="kissBtn" style="background: #ff6b95;">
                        <i class="fas fa-kiss-wink-heart"></i>
                    </button>
                    <button class="action-btn" id="heartbeatBtn" style="background: #ff4757;">
                        <i class="fas fa-heartbeat"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        // =================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDy9jmys9AcELdM7mdpySolC7JDyWr8nY0",
            authDomain: "lover-chat-523fa.firebaseapp.com",
            databaseURL: "https://lover-chat-523fa-default-rtdb.firebaseio.com",
            projectId: "lover-chat-523fa",
            storageBucket: "lover-chat-523fa.firebasestorage.app",
            messagingSenderId: "377312103297",
            appId: "1:377312103297:web:8b23979517c3b69d34f680",
            measurementId: "G-N42BMX8SGJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const database = firebase.database();

        // =================================================================
        // ğŸ’¬ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        // =================================================================
        const chatApp = {
            // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary
            CLOUDINARY_CLOUD_NAME: 'dopzq8owd',
            CLOUDINARY_UPLOAD_PRESET: 'lover_chat',

            // ğŸ”Š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØµÙˆØ§Øª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
            soundLibrary: {
                send: 'send.mp3',
                kiss: 'kiss.mp3',
                heartbeat: 'heartbeat.mp3',
                emoji: 'emoji.mp3',
                reaction: 'reaction.mp3',
                magic: 'magic.mp3',
                join: 'join.mp3',
                notification: 'notification.mp3'
            },

            // ğŸ‘¥ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            mockUsers: {
                user1: {
                    id: 'user1',
                    name: 'Ù…Ø­Ù…Ø¯',
                    email: 'mohamed@example.com',
                    avatar: 'â¤ï¸'
                },
                user2: {
                    id: 'user2',
                    name: 'Ø­Ù„ÙˆÙ…Ø©',
                    email: 'haloma@example.com',
                    avatar: 'ğŸ’•'
                }
            },

            // ğŸ’¾ ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            messages: [],
            users: [],
            currentUser: null,
            currentFileToUpload: null,
            currentFileType: null,
            typingUsers: [],
            audioEnabled: false,

            init() {
                console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©...');
                this.setupEventListeners();
                this.enableAudio();
                this.setupAutoSync(); // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            },

            // ğŸ”„ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            setupAutoSync() {
                console.log('ğŸ”„ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©...');
                this.setupSoundSync();
                this.setupEmojiSync();
                this.setupEffectsSync();
            },

            // ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
            enableAudio() {
                document.addEventListener('click', () => {
                    if (!this.audioEnabled) {
                        this.audioEnabled = true;
                    }
                });
                document.addEventListener('touchstart', () => {
                    if (!this.audioEnabled) {
                        this.audioEnabled = true;
                    }
                });
            },

            // ğŸ”Š Ù…Ø´ØºÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª - Ù…Ø¹ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            playSound(soundName) {
                if (!this.audioEnabled) return;
                
                const soundPath = this.soundLibrary[soundName];
                if (soundPath) {
                    const audio = new Audio(soundPath);
                    audio.volume = 0.7;
                    audio.play().catch(e => console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e));
                    
                    // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØµÙˆØª Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
                    this.syncPlaySound(soundName);
                }
            },

            // ğŸ”Š Ù…Ø²Ø§Ù…Ù†Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
            syncPlaySound(soundName) {
                if (!database) return;
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                database.ref('sync/sounds').set({
                    soundName: soundName,
                    timestamp: Date.now(),
                    playedBy: this.getUserId()
                });
            },

            // ğŸ­ Ù…Ø²Ø§Ù…Ù†Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
            syncEmojiEffect(type, emojis, count) {
                if (!database) return;
                
                // Ø¥Ø±Ø³Ø§Ù„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                database.ref('sync/emojis').set({
                    type: type,
                    emojis: emojis,
                    count: count,
                    timestamp: Date.now(),
                    triggeredBy: this.getUserId()
                });
            },

            // âœ¨ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
            syncVisualEffect(effectType, data) {
                if (!database) return;
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ØµØ±ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                database.ref('sync/effects').set({
                    effectType: effectType,
                    data: data,
                    timestamp: Date.now(),
                    triggeredBy: this.getUserId()
                });
            },

            // ğŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø£ØµÙˆØ§Øª
            setupSoundSync() {
                if (!database) return;
                
                // Ù…Ø³ØªÙ…Ø¹ Ù„Ø£ÙˆØ§Ù…Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
                database.ref('sync/sounds').on('value', (snapshot) => {
                    const soundData = snapshot.val();
                    if (soundData && soundData.triggeredBy !== this.getUserId()) {
                        console.log('ğŸ”Š ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù…ØªØ²Ø§Ù…Ù†:', soundData.soundName);
                        this.playSoundLocal(soundData.soundName);
                    }
                });
            },

            // ğŸ­ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
            setupEmojiSync() {
                if (!database) return;
                
                // Ù…Ø³ØªÙ…Ø¹ Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
                database.ref('sync/emojis').on('value', (snapshot) => {
                    const effectData = snapshot.val();
                    if (effectData && effectData.triggeredBy !== this.getUserId()) {
                        console.log('ğŸ­ ØªØ´ØºÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…ØªØ²Ø§Ù…Ù†:', effectData.type);
                        this.handleEmojiEffect(effectData);
                    }
                });
            },

            // âœ¨ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
            setupEffectsSync() {
                if (!database) return;
                
                // Ù…Ø³ØªÙ…Ø¹ Ù„Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
                database.ref('sync/effects').on('value', (snapshot) => {
                    const effectData = snapshot.val();
                    if (effectData && effectData.triggeredBy !== this.getUserId()) {
                        console.log('âœ¨ ØªØ´ØºÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù…ØªØ²Ø§Ù…Ù†:', effectData.effectType);
                        this.handleVisualEffect(effectData);
                    }
                });
            },

            // ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ø­Ù„ÙŠØ§Ù‹ (Ø¨Ø¯ÙˆÙ† Ù…Ø²Ø§Ù…Ù†Ø©)
            playSoundLocal(soundName) {
                if (!this.audioEnabled) return;
                
                const soundPath = this.soundLibrary[soundName];
                if (soundPath) {
                    const audio = new Audio(soundPath);
                    audio.volume = 0.7;
                    audio.play().catch(e => console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e));
                }
            },

            // ğŸ­ Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
            handleEmojiEffect(effectData) {
                const { type, emojis, count } = effectData;
                
                if (type === 'kiss') {
                    this.createFloatingEmojis(emojis, count);
                } else if (type === 'heartbeat') {
                    this.createHearts(count);
                } else if (type === 'emoji') {
                    this.createFloatingEmojis(emojis, count);
                } else if (type === 'hearts') {
                    this.createHearts(count);
                }
            },

            // âœ¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ØµØ±ÙŠ
            handleVisualEffect(effectData) {
                const { effectType, data } = effectData;
                
                if (effectType === 'bubbles') {
                    this.createBubbles(data.count || 3);
                }
            },

            // ğŸ†” Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            getUserId() {
                return this.currentUser ? this.currentUser.id : 'anonymous';
            },

            // ğŸ”— Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            setupEventListeners() {
                console.log('ğŸ¯ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©...');
                
                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
                document.getElementById('verifyCode').addEventListener('click', () => {
                    this.verifyAccessCode();
                });

                document.getElementById('accessCode').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.verifyAccessCode();
                    }
                });

                // Ø­Ø¯Ø« ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.logout();
                });

                // Ø­Ø¯Ø« ØªØ¨Ø¯ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                document.getElementById('mobileUsersToggle').addEventListener('click', () => {
                    document.getElementById('usersSidebar').classList.toggle('active');
                });

                // Ø£Ø­Ø¯Ø§Ø« Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                document.getElementById('sendBtn').addEventListener('click', () => {
                    this.sendMessage();
                });

                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®Ø§ØµØ©
                document.getElementById('kissBtn').addEventListener('click', () => {
                    this.playSound('kiss');
                    this.createFloatingEmojis(['ğŸ’‹', 'ğŸ˜˜', 'ğŸ’‹'], 10);
                    // Ù…Ø²Ø§Ù…Ù†Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„ÙˆØ¨
                    this.syncEmojiEffect('kiss', ['ğŸ’‹', 'ğŸ˜˜', 'ğŸ’‹'], 10);
                });

                document.getElementById('heartbeatBtn').addEventListener('click', () => {
                    this.playSound('heartbeat');
                    this.createHearts(8);
                    // Ù…Ø²Ø§Ù…Ù†Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„ÙˆØ¨
                    this.syncEmojiEffect('heartbeat', ['ğŸ’–'], 8);
                });

                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
                document.getElementById('attachBtn').addEventListener('click', (e) => {
                    document.getElementById('fileUploadContainer').style.display = 
                        document.getElementById('fileUploadContainer').style.display === 'block' ? 'none' : 'block';
                    document.getElementById('emojiPicker').style.display = 'none';
                });

                document.getElementById('emojiBtn').addEventListener('click', (e) => {
                    document.getElementById('emojiPicker').style.display = 
                        document.getElementById('emojiPicker').style.display === 'block' ? 'none' : 'block';
                    document.getElementById('fileUploadContainer').style.display = 'none';
                });

                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø­Ø«
                document.getElementById('searchBtn').addEventListener('click', () => {
                    this.performSearch();
                });

                document.getElementById('searchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });

                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
                document.querySelectorAll('.emoji').forEach(emojiElement => {
                    emojiElement.addEventListener('click', () => {
                        document.getElementById('messageInput').value += emojiElement.textContent;
                        document.getElementById('messageInput').focus();
                        this.playSound('emoji');
                        this.createFloatingEmojis([emojiElement.textContent], 5);
                        // Ù…Ø²Ø§Ù…Ù†Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
                        this.syncEmojiEffect('emoji', [emojiElement.textContent], 5);
                    });
                });

                // Ø£Ø­Ø¯Ø§Ø« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø±Ø§Øª
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.emoji-btn') && !e.target.closest('.emoji-picker')) {
                        document.getElementById('emojiPicker').style.display = 'none';
                    }
                    
                    if (!e.target.closest('#attachBtn') && !e.target.closest('.file-upload-container')) {
                        document.getElementById('fileUploadContainer').style.display = 'none';
                    }
                    
                    if (!e.target.closest('.message-action') && !e.target.closest('.reaction-picker')) {
                        document.querySelectorAll('.reaction-picker').forEach(picker => {
                            picker.style.display = 'none';
                        });
                    }
                    
                    if (window.innerWidth <= 768 && !e.target.closest('.users-sidebar') && !e.target.closest('.mobile-users-toggle')) {
                        document.getElementById('usersSidebar').classList.remove('active');
                    }
                });

                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù„ÙØ§Øª
                document.getElementById('closePreview').addEventListener('click', () => {
                    this.closeFilePreview();
                });

                document.getElementById('cancelFileBtn').addEventListener('click', () => {
                    this.closeFilePreview();
                });

                document.getElementById('sendFileBtn').addEventListener('click', async () => {
                    await this.sendFile();
                });

                document.getElementById('imageInput').addEventListener('change', (e) => {
                    const files = e.target.files;
                    if (files.length > 0) {
                        if (files.length === 1) {
                            this.showPreview(files[0], 'image');
                        } else {
                            this.uploadMultipleFiles(files, 'image');
                        }
                    }
                });

                document.getElementById('videoInput').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.showPreview(file, 'video');
                    }
                });

                document.getElementById('fileInput').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.showPreview(file, 'file');
                    }
                });

                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
            },

            // ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
            verifyAccessCode() {
                const accessCode = document.getElementById('accessCode').value;
                const codeError = document.getElementById('codeError');
                
                if (accessCode === '1024') {
                    // Ø§Ù„ÙƒÙˆØ¯ ØµØ­ÙŠØ­ØŒ Ø¥Ø¸Ù‡Ø§Ø± Ø®ÙŠØ§Ø±Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    document.querySelector('.quick-login').innerHTML = `
                        <button id="loginUser1">
                            <i class="fas fa-heart"></i> Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ Ù…Ø­Ù…Ø¯
                        </button>
                        <button id="loginUser2">
                            <i class="fas fa-heart"></i> Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ Ø­Ù„ÙˆÙ…Ø©
                        </button>
                    `;
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                    document.getElementById('loginUser1').addEventListener('click', () => {
                        this.loginUser(this.mockUsers.user1);
                    });

                    document.getElementById('loginUser2').addEventListener('click', () => {
                        this.loginUser(this.mockUsers.user2);
                    });
                    
                    codeError.style.display = 'none';
                } else {
                    // Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­
                    codeError.style.display = 'block';
                }
            },

            // ğŸ‘¤ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            loginUser(user) {
                this.currentUser = user;
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firebase
                db.collection('users').doc(user.id).set({
                    name: user.name,
                    avatar: user.avatar,
                    isOnline: true,
                    lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('chatApp').classList.remove('hidden');
                
                document.getElementById('userAvatar').textContent = user.avatar;
                document.getElementById('userName').textContent = user.name;
                
                this.loadMessages();
                this.loadUsers();
                this.setupRealtimeListeners();
                
                this.playSound('join');
            },

            // ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            logout() {
                if (this.currentUser) {
                    db.collection('users').doc(this.currentUser.id).update({
                        isOnline: false,
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                this.currentUser = null;
                document.getElementById('chatApp').classList.add('hidden');
                document.getElementById('authScreen').classList.remove('hidden');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù‚Ù‚
                document.querySelector('.quick-login').innerHTML = `
                    <button id="verifyCode">
                        <i class="fas fa-lock"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                `;
                document.getElementById('accessCode').value = '';
                document.getElementById('codeError').style.display = 'none';
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø²Ø±
                document.getElementById('verifyCode').addEventListener('click', () => {
                    this.verifyAccessCode();
                });
            },

            // ğŸ“¡ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
            setupRealtimeListeners() {
                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                db.collection('messages')
                    .orderBy('timestamp', 'asc')
                    .onSnapshot((snapshot) => {
                        this.messages = [];
                        snapshot.forEach((doc) => {
                            this.messages.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        this.loadMessages();
                    });

                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                db.collection('users')
                    .onSnapshot((snapshot) => {
                        this.users = [];
                        snapshot.forEach((doc) => {
                            this.users.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        this.loadUsers();
                    });
            },

            // ğŸ“¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            loadMessages() {
                const messagesContainer = document.getElementById('messagesContainer');
                messagesContainer.innerHTML = '';
                
                this.messages
                    .sort((a, b) => a.timestamp - b.timestamp)
                    .forEach(message => {
                        this.displayMessage(message);
                    });
                this.scrollToBottom();
            },

            // ğŸ’¬ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            displayMessage(message, isSearchResult = false) {
                const messagesContainer = document.getElementById('messagesContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.senderId === this.currentUser.id ? 'user' : 'other'}`;
                messageDiv.dataset.id = message.id;
                
                let messageText = message.text;
                
                let messageContent = `
                    <div class="message-header">
                        <span>${message.senderName}</span>
                        <span>${this.formatTime(message.timestamp?.toDate())}</span>
                    </div>
                `;
                
                if (message.replyTo) {
                    messageContent += `
                        <div class="reply-indicator">
                            Ø±Ø¯ Ø¹Ù„Ù‰: ${message.replyTo.text.substring(0, 50)}${message.replyTo.text.length > 50 ? '...' : ''}
                        </div>
                    `;
                }
                
                messageContent += `<div class="message-text">${messageText}</div>`;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
                if (message.fileUrl) {
                    if (message.fileType === 'image') {
                        messageContent += `
                            <div class="file-attachment">
                                <img src="${message.fileUrl}" alt="ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©" onclick="chatApp.previewFile('${message.fileUrl}', 'image')">
                                <div style="font-size: 0.8rem; margin-top: 5px;">${message.fileName || 'ØµÙˆØ±Ø©'}</div>
                            </div>
                        `;
                    } else if (message.fileType === 'video') {
                        messageContent += `
                            <div class="file-attachment">
                                <video controls style="max-width: 250px; border-radius: 8px;" onclick="chatApp.previewFile('${message.fileUrl}', 'video')">
                                    <source src="${message.fileUrl}" type="video/mp4">
                                    Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                                </video>
                                <div style="font-size: 0.8rem; margin-top: 5px;">${message.fileName || 'ÙÙŠØ¯ÙŠÙˆ'}</div>
                            </div>
                        `;
                    } else {
                        messageContent += `
                            <div class="file-attachment">
                                <i class="fas fa-file"></i>
                                <a href="${message.fileUrl}" target="_blank" download="${message.fileName}">
                                    ${message.fileName || 'Ù…Ù„Ù Ù…Ø±ÙÙ‚'}
                                </a>
                            </div>
                        `;
                    }
                }
                
                // ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
                if (message.reactions && Object.keys(message.reactions).length > 0) {
                    messageContent += `<div class="message-reactions">`;
                    for (const [emoji, users] of Object.entries(message.reactions)) {
                        messageContent += `
                            <div class="reaction" onclick="chatApp.addReaction('${message.id}', '${emoji}')">
                                <span>${emoji}</span>
                                <span class="reaction-count">${users.length}</span>
                            </div>
                        `;
                    }
                    messageContent += `</div>`;
                }
                
                messageContent += `
                    <div class="message-actions">
                        <span class="message-action" onclick="chatApp.showReactionPicker('${message.id}')">
                            <i class="fas fa-heart"></i>
                        </span>
                        <span class="message-action" onclick="chatApp.replyToMessage('${message.id}')">
                            <i class="fas fa-reply"></i>
                        </span>
                        ${message.senderId === this.currentUser.id ? `
                            <span class="message-action" onclick="chatApp.editMessage('${message.id}')">
                                <i class="fas fa-edit"></i>
                            </span>
                            <span class="message-action" onclick="chatApp.deleteMessage('${message.id}')">
                                <i class="fas fa-trash"></i>
                            </span>
                        ` : ''}
                    </div>
                `;
                
                messageDiv.innerHTML = messageContent;
                messagesContainer.appendChild(messageDiv);
                
                // Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
                const reactionPicker = document.createElement('div');
                reactionPicker.className = 'reaction-picker';
                reactionPicker.id = `reaction-picker-${message.id}`;
                reactionPicker.innerHTML = `
                    <span class="reaction-option" onclick="chatApp.addReaction('${message.id}', 'ğŸ’–')">ğŸ’–</span>
                    <span class="reaction-option" onclick="chatApp.addReaction('${message.id}', 'â¤ï¸')">â¤ï¸</span>
                    <span class="reaction-option" onclick="chatApp.addReaction('${message.id}', 'ğŸ˜˜')">ğŸ˜˜</span>
                    <span class="reaction-option" onclick="chatApp.addReaction('${message.id}', 'ğŸ¥°')">ğŸ¥°</span>
                    <span class="reaction-option" onclick="chatApp.addReaction('${message.id}', 'ğŸŒ¹')">ğŸŒ¹</span>
                    <span class="reaction-option" onclick="chatApp.addReaction('${message.id}', 'ğŸ’•')">ğŸ’•</span>
                `;
                messageDiv.appendChild(reactionPicker);
            },

            // ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
            sendMessage() {
                const text = document.getElementById('messageInput').value.trim();
                if (text === '') return;
                
                db.collection('messages').add({
                    text: text,
                    senderId: this.currentUser.id,
                    senderName: this.currentUser.name,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    reactions: {}
                });
                
                document.getElementById('messageInput').value = '';
                this.createBubbles(3);
                
                const emojiMatches = text.match(/\p{Emoji}/gu);
                if (emojiMatches) {
                    this.playSound('send');
                    setTimeout(() => {
                        this.playSound('emoji');
                        this.createFloatingEmojis(emojiMatches, 15);
                        // Ù…Ø²Ø§Ù…Ù†Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
                        this.syncEmojiEffect('emoji', emojiMatches, 15);
                    }, 300);
                } else {
                    this.playSound('send');
                }
                
                if (text.includes('Ø­Ø¨') || text.includes('Ø­Ø¨ÙŠ') || text.includes('Ø¹Ø´Ù‚') || text.includes('Ù‚Ù„Ø¨ÙŠ')) {
                    this.createHearts(5);
                    // Ù…Ø²Ø§Ù…Ù†Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„ÙˆØ¨
                    this.syncEmojiEffect('hearts', ['ğŸ’–'], 5);
                }
            },

            // â˜ï¸ Ø±ÙØ¹ Ù…Ù„Ù Ø¥Ù„Ù‰ Cloudinary
            async uploadToCloudinary(file) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', this.CLOUDINARY_UPLOAD_PRESET);
                
                try {
                    document.getElementById('uploadProgress').style.display = 'block';
                    document.getElementById('uploadProgressBar').style.width = '30%';

                    const response = await fetch(`https://api.cloudinary.com/v1_1/${this.CLOUDINARY_CLOUD_NAME}/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    document.getElementById('uploadProgressBar').style.width = '70%';

                    const data = await response.json();
                    
                    document.getElementById('uploadProgressBar').style.width = '100%';
                    
                    if (data.secure_url) {
                        this.showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!');
                        return data.secure_url;
                    } else {
                        throw new Error('ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù');
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù:', error);
                    this.showNotification('âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù');
                    return null;
                } finally {
                    setTimeout(() => {
                        document.getElementById('uploadProgress').style.display = 'none';
                        document.getElementById('uploadProgressBar').style.width = '0%';
                    }, 1000);
                }
            },

            // ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ù
            async sendFile() {
                if (!this.currentFileToUpload) return;

                const fileUrl = await this.uploadToCloudinary(this.currentFileToUpload);

                if (fileUrl) {
                    await db.collection('messages').add({
                        text: '',
                        senderId: this.currentUser.id,
                        senderName: this.currentUser.name,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        fileUrl: fileUrl,
                        fileType: this.currentFileType,
                        fileName: this.currentFileToUpload.name,
                        reactions: {}
                    });

                    this.closeFilePreview();
                    this.showNotification('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!');
                    this.playSound('send');
                    this.createBubbles(2);
                }
            },

            // ğŸ‘¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            loadUsers() {
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';
                let onlineUsers = 0;
                
                this.users.forEach(user => {
                    if (user.id !== this.currentUser.id) {
                        const userItem = document.createElement('div');
                        userItem.className = 'user-item';
                        
                        const lastSeen = user.lastSeen ? user.lastSeen.toDate() : new Date();
                        const isOnline = user.isOnline && (new Date() - lastSeen < 300000);
                        
                        userItem.innerHTML = `
                            <div class="user-status ${isOnline ? '' : 'offline'}"></div>
                            <div class="user-avatar">${user.avatar}</div>
                            <div class="user-details">
                                <div class="user-name">${user.name}</div>
                                <div class="user-status-text">${isOnline ? 'Ù…ØªØµÙ„/Ø©' : 'ØºÙŠØ± Ù…ØªØµÙ„/Ø©'}</div>
                            </div>
                        `;
                        usersList.appendChild(userItem);
                    }
                    
                    if (user.isOnline) onlineUsers++;
                });
                
                document.getElementById('onlineCount').textContent = `${onlineUsers} Ù…ØªØµÙ„ÙˆÙ†`;
            },

            // â° ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
            formatTime(timestamp) {
                if (!timestamp) return '';
                return timestamp.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
            },

            // ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            showNotification(text) {
                const notification = document.getElementById('notification');
                notification.textContent = text;
                notification.style.display = 'block';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            },

            // âœ¨ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
            createFloatingEmojis(emojis, count) {
                this.playSound('magic');
                
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const emoji = document.createElement('div');
                        emoji.className = 'floating-emoji';
                        emoji.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
                        emoji.style.left = Math.random() * 100 + 'vw';
                        emoji.style.top = '-50px';
                        emoji.style.fontSize = (Math.random() * 15 + 30) + 'px';
                        emoji.style.animationDuration = (Math.random() * 2 + 4) + 's';
                        document.body.appendChild(emoji);
                        
                        setTimeout(() => {
                            if (emoji.parentNode) {
                                emoji.remove();
                            }
                        }, 6000);
                    }, i * 200);
                }
            },

            createHearts(count) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'heart';
                        heart.innerHTML = 'ğŸ’–';
                        heart.style.left = Math.random() * 100 + 'vw';
                        heart.style.fontSize = (Math.random() * 20 + 20) + 'px';
                        document.body.appendChild(heart);
                        
                        setTimeout(() => {
                            if (heart.parentNode) {
                                heart.remove();
                            }
                        }, 3000);
                    }, i * 200);
                }
            },

            createBubbles(count) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const bubble = document.createElement('div');
                        bubble.className = 'bubble';
                        bubble.style.left = Math.random() * 100 + 'vw';
                        bubble.style.top = '80vh';
                        bubble.style.width = bubble.style.height = (Math.random() * 50 + 20) + 'px';
                        document.body.appendChild(bubble);
                        
                        setTimeout(() => {
                            if (bubble.parentNode) {
                                bubble.remove();
                            }
                        }, 2000);
                    }, i * 100);
                }
            },

            // ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
            openFilePicker(type) {
                document.getElementById('fileUploadContainer').style.display = 'none';
                
                switch(type) {
                    case 'image':
                        document.getElementById('imageInput').click();
                        break;
                    case 'video':
                        document.getElementById('videoInput').click();
                        break;
                    case 'file':
                        document.getElementById('fileInput').click();
                        break;
                }
            },

            showPreview(file, type) {
                this.currentFileToUpload = file;
                this.currentFileType = type;

                const reader = new FileReader();
                
                reader.onload = function(e) {
                    if (type === 'image') {
                        document.getElementById('previewImage').src = e.target.result;
                        document.getElementById('previewImage').style.display = 'block';
                        document.getElementById('previewVideo').style.display = 'none';
                    } else if (type === 'video') {
                        document.getElementById('previewVideo').src = e.target.result;
                        document.getElementById('previewVideo').style.display = 'block';
                        document.getElementById('previewImage').style.display = 'none';
                    } else {
                        document.getElementById('previewImage').src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23e91e63"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><text x="12" y="18" text-anchor="middle" font-size="8" fill="white">' + this.getFileExtension(file.name) + '</text></svg>';
                        document.getElementById('previewImage').style.display = 'block';
                        document.getElementById('previewVideo').style.display = 'none';
                    }
                    
                    document.getElementById('sendFileBtn').style.display = 'block';
                    document.getElementById('previewContainer').style.display = 'flex';
                };
                
                reader.readAsDataURL(file);
            },

            getFileExtension(filename) {
                return filename.split('.').pop().toUpperCase();
            },

            closeFilePreview() {
                document.getElementById('previewContainer').style.display = 'none';
                this.currentFileToUpload = null;
                this.currentFileType = null;
                document.getElementById('imageInput').value = '';
                document.getElementById('videoInput').value = '';
                document.getElementById('fileInput').value = '';
            },

            async uploadMultipleFiles(files, type) {
                this.showNotification(`ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ${files.length} Ù…Ù„Ù...`);
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const fileUrl = await this.uploadToCloudinary(file);
                    if (fileUrl) {
                        await db.collection('messages').add({
                            text: '',
                            senderId: this.currentUser.id,
                            senderName: this.currentUser.name,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            fileUrl: fileUrl,
                            fileType: type,
                            fileName: file.name,
                            reactions: {}
                        });
                    }
                }
                
                this.showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!');
            },

            previewFile(fileUrl, fileType) {
                if (fileType === 'image') {
                    document.getElementById('previewImage').src = fileUrl;
                    document.getElementById('previewImage').style.display = 'block';
                    document.getElementById('previewVideo').style.display = 'none';
                } else if (fileType === 'video') {
                    document.getElementById('previewVideo').src = fileUrl;
                    document.getElementById('previewVideo').style.display = 'block';
                    document.getElementById('previewImage').style.display = 'none';
                }
                
                document.getElementById('sendFileBtn').style.display = 'none';
                document.getElementById('previewContainer').style.display = 'flex';
            },

            // ğŸ”¼ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„
            scrollToBottom() {
                const messagesContainer = document.getElementById('messagesContainer');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },

            // â¤ï¸ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
            addReaction(messageId, emoji) {
                const messageRef = db.collection('messages').doc(messageId);
                
                db.runTransaction(async (transaction) => {
                    const messageDoc = await transaction.get(messageRef);
                    if (!messageDoc.exists) return;
                    
                    const messageData = messageDoc.data();
                    const reactions = messageData.reactions || {};
                    
                    if (!reactions[emoji]) {
                        reactions[emoji] = [];
                    }
                    
                    const userIndex = reactions[emoji].indexOf(this.currentUser.id);
                    if (userIndex > -1) {
                        reactions[emoji].splice(userIndex, 1);
                        if (reactions[emoji].length === 0) {
                            delete reactions[emoji];
                        }
                    } else {
                        reactions[emoji].push(this.currentUser.id);
                    }
                    
                    transaction.update(messageRef, { reactions });
                }).then(() => {
                    this.playSound('reaction');
                    this.createFloatingEmojis([emoji], 8);
                    
                    const reactionPicker = document.getElementById(`reaction-picker-${messageId}`);
                    if (reactionPicker) {
                        reactionPicker.style.display = 'none';
                    }
                });
            },

            showReactionPicker(messageId) {
                document.querySelectorAll('.reaction-picker').forEach(picker => {
                    picker.style.display = 'none';
                });
                
                const reactionPicker = document.getElementById(`reaction-picker-${messageId}`);
                if (reactionPicker) {
                    reactionPicker.style.display = 'flex';
                }
            },

            // ğŸ—‘ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            deleteMessage(messageId) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) {
                    db.collection('messages').doc(messageId).delete();
                }
            },

            editMessage(messageId) {
                const message = this.messages.find(m => m.id === messageId);
                if (message) {
                    const newText = prompt('Ø¹Ø¯Ù„ Ø±Ø³Ø§Ù„ØªÙƒ:', message.text);
                    if (newText !== null && newText.trim() !== '') {
                        db.collection('messages').doc(messageId).update({
                            text: newText
                        });
                    }
                }
            },

            replyToMessage(messageId) {
                const message = this.messages.find(m => m.id === messageId);
                if (message) {
                    document.getElementById('messageInput').value = `Ø±Ø¯ Ø¹Ù„Ù‰ ${message.senderName}: ${message.text.substring(0, 30)}... `;
                    document.getElementById('messageInput').focus();
                }
            },

            // ğŸ” Ø§Ù„Ø¨Ø­Ø«
            performSearch() {
                const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
                
                if (searchTerm === '') {
                    this.loadMessages();
                    return;
                }

                const filteredMessages = this.messages.filter(message => 
                    message.text.toLowerCase().includes(searchTerm)
                );

                if (filteredMessages.length === 0) {
                    this.showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬');
                    return;
                }

                const messagesContainer = document.getElementById('messagesContainer');
                messagesContainer.innerHTML = '';
                filteredMessages.forEach(message => {
                    this.displayMessage(message, true);
                });

                if (filteredMessages.length > 0) {
                    const firstMessage = document.querySelector('.message');
                    if (firstMessage) {
                        firstMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        firstMessage.classList.add('highlighted');
                        
                        setTimeout(() => {
                            firstMessage.classList.remove('highlighted');
                        }, 3000);
                    }
                }
            }
        };

        // =================================================================
        // ğŸµ Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        // =================================================================
        const mediaPlayer = {
            // â˜ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary
            cloudinaryConfig: {
                cloudName: 'dopzq8owd',
                uploadPreset: 'media_player',
                apiKey: '947396287311916',
                maxFileSize: 300 * 1024 * 1024
            },

            // ğŸ® Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            LOVERS_ROOM: "LOVERS_ROOM",
            isSyncing: false,
            currentMediaType: 'video',
            isAudioMiniPlayerVisible: false,
            videoPlayer: null,
            audioPlayer: null,
            lastSyncTime: 0,
            currentLinkType: 'youtube',
            isNewUser: false,

            init() {
                console.log('ğŸµ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·...');
                this.setupEventListeners();
                this.loadMediaLibrary();
                this.setupVideoPlayer();
                this.setupAudioPlayer();
                this.loadSavedLinks();
                this.showMediaStatus('âœ… Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø¬Ø§Ù‡Ø²! Ø§Ø¶ØºØ· "Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©"', 'success');
            },

            // ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            setupEventListeners() {
                console.log('ğŸ¯ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·...');
                
                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø±ÙØ¹
                document.getElementById('uploadForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.uploadToCloudinaryMedia(e);
                });
                
                // Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØµØºØ±Ø©
                document.getElementById('syncBtn').addEventListener('click', () => this.showModal('syncModal'));
                document.getElementById('videosBtn').addEventListener('click', () => this.showModal('videosModal'));
                document.getElementById('audioLibraryBtn').addEventListener('click', () => this.showModal('audiosModal'));
                document.getElementById('audioToggleBtn').addEventListener('click', () => this.toggleAudioMiniPlayer());
                document.getElementById('uploadBtn').addEventListener('click', () => this.showModal('uploadModal'));
                document.getElementById('linksBtn').addEventListener('click', () => this.showModal('linksModal'));
                
                // Ø£Ø­Ø¯Ø§Ø« ØªØ¨ÙˆÙŠØ¨Ø§Øª Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
                document.querySelectorAll('.file-type-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        document.querySelectorAll('.file-type-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        mediaPlayer.currentMediaType = this.dataset.type;
                        document.getElementById('fileInput').accept = mediaPlayer.currentMediaType === 'video' ? 'video/*' : 'audio/*';
                        mediaPlayer.showMediaStatus(`âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${mediaPlayer.currentMediaType === 'video' ? 'ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª' : 'Ø£ØºØ§Ù†ÙŠ'}`, 'info');
                    });
                });
                
                // Ø£Ø­Ø¯Ø§Ø« ØªØ¨ÙˆÙŠØ¨Ø§Øª Ù†ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø·
                document.querySelectorAll('#linksModal .file-type-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        document.querySelectorAll('#linksModal .file-type-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        mediaPlayer.currentLinkType = this.dataset.type;
                        mediaPlayer.updateLinkPlaceholder();
                    });
                });
                
                // Ø£Ø­Ø¯Ø§Ø« ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
                document.getElementById('linkForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.playFromLink();
                });
                
                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙ…Ø¹ÙŠ Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·');
            },

            // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø·
            updateLinkPlaceholder() {
                const linkInput = document.getElementById('mediaLink');
                const examples = {
                    youtube: 'https://www.youtube.com/watch?v=... Ø£Ùˆ https://youtu.be/...',
                    mediafire: 'https://www.mediafire.com/file/...',
                    gdrive: 'https://drive.google.com/file/d/.../view',
                    direct: 'https://example.com/video.mp4',
                    other: 'https://example.com/media'
                };
                
                linkInput.placeholder = examples[this.currentLinkType] || 'Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ³Ø§Ø¦Ø·...';
            },

            // ğŸ¬ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            setupVideoPlayer() {
                console.log('ğŸ¬ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...');
                
                this.videoPlayer = document.getElementById('videoPlayer');
                const playPauseBtn = document.getElementById('play-pause-btn');
                const rewindBtn = document.getElementById('rewind-btn');
                const forwardBtn = document.getElementById('forward-btn');

                if (!this.videoPlayer || !playPauseBtn || !rewindBtn || !forwardBtn) {
                    console.error('âŒ Ø¹Ù†Ø§ØµØ± Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                    return;
                }

                // âš¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ø³Ù†Ø© Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                this.videoPlayer.preload = "auto";
                this.videoPlayer.setAttribute('playsinline', '');
                this.videoPlayer.setAttribute('webkit-playsinline', '');
                this.videoPlayer.controls = false;

                // ğŸ® Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­ÙƒÙ…
                const togglePlayPause = () => {
                    if (this.videoPlayer.paused || this.videoPlayer.ended) {
                        this.videoPlayer.play().then(() => {
                            console.log('â–¶ ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
                            playPauseBtn.textContent = 'âšâš';
                            if (this.isSyncing) this.syncPlayVideo();
                        }).catch(error => {
                            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:', error);
                            this.videoPlayer.controls = true;
                        });
                    } else {
                        this.videoPlayer.pause();
                        console.log('â¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
                        playPauseBtn.textContent = 'â–¶';
                        if (this.isSyncing) this.syncPauseVideo();
                    }
                };

                playPauseBtn.addEventListener('click', togglePlayPause);
                this.videoPlayer.addEventListener('click', togglePlayPause);

                rewindBtn.addEventListener('click', () => {
                    this.videoPlayer.currentTime = Math.max(0, this.videoPlayer.currentTime - 10);
                    console.log('âª ØªØ±Ø¬ÙŠØ¹ 10 Ø«ÙˆØ§Ù†ÙŠ');
                    if (this.isSyncing) {
                        database.ref('rooms/' + this.LOVERS_ROOM + '/media/currentTime').set(this.videoPlayer.currentTime);
                    }
                });
                
                forwardBtn.addEventListener('click', () => {
                    this.videoPlayer.currentTime = Math.min(this.videoPlayer.duration, this.videoPlayer.currentTime + 10);
                    console.log('â© ØªÙ‚Ø¯ÙŠÙ… 10 Ø«ÙˆØ§Ù†ÙŠ');
                    if (this.isSyncing) {
                        database.ref('rooms/' + this.LOVERS_ROOM + '/media/currentTime').set(this.videoPlayer.currentTime);
                    }
                });

                // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ø¢Ø®Ø±ÙŠÙ†
                this.videoPlayer.addEventListener('timeupdate', () => {
                    if (this.isSyncing && database && !this.videoPlayer.seeking) {
                        const currentTime = Math.floor(this.videoPlayer.currentTime);
                        if (this.lastSyncTime !== currentTime && currentTime % 2 === 0) {
                            database.ref('rooms/' + this.LOVERS_ROOM + '/media/currentTime').set(currentTime);
                            this.lastSyncTime = currentTime;
                        }
                    }
                });

                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­');
            },

            // ğŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù†
            setupAudioPlayer() {
                console.log('ğŸ”Š Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù†...');
                
                this.audioPlayer = document.getElementById('audioPlayer');
                const volumeSlider = document.getElementById('volumeSlider');
                
                if (this.audioPlayer && volumeSlider) {
                    this.audioPlayer.volume = volumeSlider.value / 100;
                    this.audioPlayer.preload = "auto";
                    this.audioPlayer.crossOrigin = "anonymous";
                    
                    this.audioPlayer.addEventListener('canplay', () => {
                        console.log('ğŸ”Š ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø¢Ù†');
                    });

                    this.audioPlayer.addEventListener('play', () => {
                        console.log('â–¶ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
                        if (this.isSyncing) this.syncPlayAudio();
                        if (this.isAudioMiniPlayerVisible) {
                            document.getElementById('audioMiniTitle').textContent = document.getElementById('audioInfo').textContent;
                        }
                    });
                    
                    this.audioPlayer.addEventListener('pause', () => {
                        console.log('â¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª');
                        if (this.isSyncing) this.syncPauseAudio();
                    });

                    // ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©
                    this.audioPlayer.addEventListener('timeupdate', () => {
                        if (this.isSyncing && database && !this.audioPlayer.seeking) {
                            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø²Ø§Ø¦Ø¯
                            const currentTime = Math.floor(this.audioPlayer.currentTime);
                            if (this.lastSyncTime !== currentTime && currentTime % 2 === 0) {
                                database.ref('rooms/' + this.LOVERS_ROOM + '/media/currentTime').set(currentTime);
                                this.lastSyncTime = currentTime;
                            }
                        }
                    });
                }

                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù† Ø¨Ù†Ø¬Ø§Ø­');
            },

            // ğŸ”— ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            playFromLink() {
                const link = document.getElementById('mediaLink').value.trim();
                const title = document.getElementById('mediaTitle').value.trim() || 'ÙˆØ³Ø§Ø¦Ø· Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·';
                
                if (!link) {
                    this.showLinkStatus('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­', 'error');
                    return;
                }
                
                this.showLinkStatus('â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø§Ø¨Ø·...', 'info');
                
                // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£ÙˆÙ„Ø§Ù‹
                this.saveLink(link, title, this.currentLinkType);
                
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø§Ø¨Ø· Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                let mediaUrl = link;
                let mediaType = 'unknown';
                
                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
                if (this.isYouTubeLink(link)) {
                    mediaUrl = this.convertToEmbedUrl(link);
                    mediaType = 'video';
                    this.playYouTubeVideo(mediaUrl, title);
                } else if (this.isMediaFireLink(link)) {
                    mediaType = this.getMediaTypeFromUrl(link);
                    this.playDirectMedia(link, title, mediaType);
                } else if (this.isGoogleDriveLink(link)) {
                    mediaUrl = this.convertGoogleDriveLink(link);
                    mediaType = 'video';
                    this.playDirectMedia(mediaUrl, title, mediaType);
                } else if (this.isDirectMediaLink(link)) {
                    mediaType = this.getMediaTypeFromUrl(link);
                    this.playDirectMedia(link, title, mediaType);
                } else {
                    // Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                    mediaType = this.getMediaTypeFromUrl(link);
                    this.playDirectMedia(link, title, mediaType);
                }
            },

            // ğŸ” ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ù…Ù† Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ø±Ø§Ø¨Ø·
            getMediaTypeFromUrl(url) {
                const videoExtensions = ['.mp4', '.webm', '.ogg', '.mov', '.avi', '.mkv'];
                const audioExtensions = ['.mp3', '.wav', '.ogg', '.m4a', '.aac'];
                
                const lowerUrl = url.toLowerCase();
                
                if (videoExtensions.some(ext => lowerUrl.includes(ext))) {
                    return 'video';
                } else if (audioExtensions.some(ext => lowerUrl.includes(ext))) {
                    return 'audio';
                } else {
                    return 'unknown';
                }
            },

            // ğŸ“º ØªØ´ØºÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ YouTube
            playYouTubeVideo(embedUrl, title) {
                // ÙÙŠ Ø­Ø§Ù„Ø© YouTubeØŒ Ù†Ø³ØªØ®Ø¯Ù… iframe Ù„Ù„ØªØ¶Ù…ÙŠÙ†
                const iframe = document.createElement('iframe');
                iframe.src = embedUrl;
                iframe.width = '100%';
                iframe.height = '100%';
                iframe.allowFullscreen = true;
                iframe.frameBorder = '0';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                
                // ØªÙ†Ø¸ÙŠÙ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ¥Ø¶Ø§ÙØ© iframe
                const videoContainer = document.querySelector('.top-pane');
                videoContainer.innerHTML = '';
                videoContainer.appendChild(iframe);
                
                document.getElementById('videoPlayerContainer').style.display = 'block';
                document.getElementById('videoTitle').textContent = `ğŸ“º ${title}`;
                this.closeModal('linksModal');
                this.showLinkStatus('âœ… Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ YouTube', 'success');
                
                // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„ØºØ±ÙØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„Ø§Ù‹
                if (this.isSyncing) {
                    this.syncYouTubeVideo(embedUrl, title);
                }
            },

            // ğŸ¬ ØªØ´ØºÙŠÙ„ ÙˆØ³Ø§Ø¦Ø· Ù…Ø¨Ø§Ø´Ø±Ø©
            playDirectMedia(url, title, mediaType) {
                if (mediaType === 'video') {
                    if (!this.videoPlayer) {
                        console.error('âŒ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…Ù‡ÙŠØ¡');
                        return;
                    }
                    
                    this.videoPlayer.src = url;
                    document.getElementById('videoPlayerContainer').style.display = 'block';
                    document.getElementById('videoTitle').textContent = `ğŸ¬ ${title}`;
                    this.closeModal('linksModal');
                    this.showLinkStatus('âœ… Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'success');
                    
                    // ğŸ”„ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØºØ±ÙØ©
                    if (this.isInRoom() && this.isSyncing) {
                        this.videoPlayer.addEventListener('loadedmetadata', () => {
                            this.syncJoinCurrentTime();
                        }, { once: true });
                    }
                } else if (mediaType === 'audio') {
                    if (!this.audioPlayer) {
                        console.error('âŒ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ù‡ÙŠØ¡');
                        return;
                    }
                    
                    this.audioPlayer.src = url;
                    document.getElementById('audioInfo').textContent = title;
                    document.getElementById('audioMiniTitle').textContent = title;
                    document.getElementById('audioPlayerContainer').style.display = 'none';
                    this.showAudioMiniPlayer();
                    this.closeModal('linksModal');
                    this.showLinkStatus('âœ… Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª', 'success');
                    
                    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØºØ±ÙØ©
                    if (this.isInRoom()) {
                        this.isSyncing = true;
                        setTimeout(() => this.syncPlayAudio(), 500);
                    }
                } else {
                    this.showLinkStatus('âš ï¸ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©...', 'info');
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ÙƒÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹
                    this.videoPlayer.src = url;
                    this.videoPlayer.addEventListener('error', () => {
                        // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ Ø¬Ø±Ø¨ ÙƒØµÙˆØª
                        this.audioPlayer.src = url;
                        document.getElementById('audioInfo').textContent = title;
                        this.showAudioMiniPlayer();
                        this.showLinkStatus('âœ… Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ ÙƒØµÙˆØª', 'success');
                    });
                    
                    this.videoPlayer.addEventListener('canplay', () => {
                        document.getElementById('videoPlayerContainer').style.display = 'block';
                        document.getElementById('videoTitle').textContent = `ğŸ¬ ${title}`;
                        this.showLinkStatus('âœ… Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ ÙƒÙÙŠØ¯ÙŠÙˆ', 'success');
                        
                        // ğŸ”„ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                        if (this.isInRoom() && this.isSyncing) {
                            this.syncJoinCurrentTime();
                        }
                    });
                }
            },

            // ğŸ”— Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Firebase
            saveLink(url, title, platform) {
                if (!database) return;
                
                const linkData = {
                    url: url,
                    title: title,
                    platform: platform,
                    addedBy: this.getOrCreateUserId(),
                    timestamp: Date.now(),
                    mediaType: this.getMediaTypeFromUrl(url)
                };
                
                const linkRef = database.ref('savedLinks').push();
                linkRef.set(linkData)
                    .then(() => {
                        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·:', title);
                        this.loadSavedLinks();
                    })
                    .catch(error => {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·:', error);
                    });
            },

            // ğŸ“š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            loadSavedLinks() {
                if (!database) return;
                
                database.ref('savedLinks').orderByChild('timestamp').limitToLast(20).on('value', (snapshot) => {
                    const linksContainer = document.getElementById('savedLinks');
                    linksContainer.innerHTML = '';
                    
                    const linksData = snapshot.val();
                    if (!linksData) {
                        linksContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #ccc;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</div>';
                        return;
                    }
                    
                    const links = [];
                    Object.keys(linksData).forEach(key => {
                        links.push({ id: key, ...linksData[key] });
                    });
                    
                    // ØªØ±ØªÙŠØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
                    links.reverse().forEach(link => {
                        const linkElement = this.createLinkElement(link);
                        linksContainer.appendChild(linkElement);
                    });
                });
            },

            // ğŸ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø±Ø§Ø¨Ø·
            createLinkElement(link) {
                const div = document.createElement('div');
                div.className = 'link-item';
                
                const platformIcons = {
                    youtube: 'ğŸ“º',
                    mediafire: 'ğŸ“¦',
                    gdrive: 'â˜ï¸',
                    direct: 'ğŸ”—',
                    other: 'ğŸŒ'
                };
                
                div.innerHTML = `
                    <div class="link-platform">${platformIcons[link.platform] || 'ğŸ”—'} ${link.platform}</div>
                    <div class="link-title">${link.title}</div>
                    <div class="link-url">${link.url}</div>
                    <div class="link-actions">
                        <button class="link-action-btn" onclick="mediaPlayer.playSavedLink('${link.id}')">â–¶ ØªØ´ØºÙŠÙ„</button>
                        <button class="link-action-btn" onclick="mediaPlayer.deleteSavedLink('${link.id}')" style="background: #ff4444;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                `;
                
                return div;
            },

            // â–¶ ØªØ´ØºÙŠÙ„ Ø±Ø§Ø¨Ø· Ù…Ø­ÙÙˆØ¸
            playSavedLink(linkId) {
                if (!database) return;
                
                database.ref('savedLinks/' + linkId).once('value').then(snapshot => {
                    const link = snapshot.val();
                    if (link) {
                        document.getElementById('mediaLink').value = link.url;
                        document.getElementById('mediaTitle').value = link.title;
                        this.currentLinkType = link.platform;
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·
                        document.querySelectorAll('#linksModal .file-type-tab').forEach(tab => {
                            tab.classList.remove('active');
                            if (tab.dataset.type === link.platform) {
                                tab.classList.add('active');
                            }
                        });
                        
                        this.playFromLink();
                    }
                });
            },

            // ğŸ—‘ï¸ Ø­Ø°Ù Ø±Ø§Ø¨Ø· Ù…Ø­ÙÙˆØ¸
            deleteSavedLink(linkId) {
                if (!database) return;
                
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·ØŸ')) {
                    database.ref('savedLinks/' + linkId).remove()
                        .then(() => {
                            this.showLinkStatus('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·', 'success');
                            this.loadSavedLinks();
                        })
                        .catch(error => {
                            this.showLinkStatus('âŒ ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·', 'error');
                        });
                }
            },

            // ğŸ” Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            isYouTubeLink(url) {
                return url.includes('youtube.com') || url.includes('youtu.be');
            },

            isMediaFireLink(url) {
                return url.includes('mediafire.com');
            },

            isGoogleDriveLink(url) {
                return url.includes('drive.google.com');
            },

            isDirectMediaLink(url) {
                const mediaExtensions = ['.mp4', '.webm', '.ogg', '.mov', '.avi', '.mkv', '.mp3', '.wav', '.m4a', '.aac'];
                return mediaExtensions.some(ext => url.toLowerCase().includes(ext));
            },

            // ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø±ÙˆØ§Ø¨Ø· YouTube Ø¥Ù„Ù‰ ØªØ¶Ù…ÙŠÙ†
            convertToEmbedUrl(url) {
                if (url.includes('youtube.com/watch?v=')) {
                    const videoId = url.split('v=')[1].split('&')[0];
                    return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                } else if (url.includes('youtu.be/')) {
                    const videoId = url.split('youtu.be/')[1].split('?')[0];
                    return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                }
                return url;
            },

            // ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø±ÙˆØ§Ø¨Ø· Google Drive
            convertGoogleDriveLink(url) {
                if (url.includes('/file/d/')) {
                    const fileId = url.split('/file/d/')[1].split('/')[0];
                    return `https://drive.google.com/uc?export=download&id=${fileId}`;
                }
                return url;
            },

            // ğŸµ ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ù…Ø´ØºÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ù…ØµØºØ±
            toggleAudioMiniPlayer() {
                if (this.isAudioMiniPlayerVisible) {
                    this.hideAudioMiniPlayer();
                } else {
                    this.showAudioMiniPlayer();
                }
            },

            showAudioMiniPlayer() {
                document.getElementById('audioMiniPlayer').style.display = 'block';
                this.isAudioMiniPlayerVisible = true;
                if (this.audioPlayer && this.audioPlayer.src) {
                    document.getElementById('audioMiniTitle').textContent = document.getElementById('audioInfo').textContent;
                }
            },

            hideAudioMiniPlayer() {
                document.getElementById('audioMiniPlayer').style.display = 'none';
                this.isAudioMiniPlayerVisible = false;
            },

            // ğŸ†” Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹
            getOrCreateUserId() {
                let userId = localStorage.getItem('mediaSyncUserId');
                if (!userId) {
                    userId = 'user_' + Math.random().toString(36).substring(2, 9);
                    localStorage.setItem('mediaSyncUserId', userId);
                }
                return userId;
            },

            // ğŸªŸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙˆØ§ÙØ°
            showModal(modalId) {
                document.getElementById(modalId).style.display = 'flex';
            },

            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            },

            // ğŸ¬ Ø¥ØºÙ„Ø§Ù‚ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            closeVideoPlayer() {
                document.getElementById('videoPlayerContainer').style.display = 'none';
                if (this.videoPlayer) {
                    this.videoPlayer.pause();
                }
                if (this.isSyncing) {
                    this.syncPauseVideo();
                }
            },

            // ğŸµ Ø¥ØºÙ„Ø§Ù‚ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
            closeAudioPlayer() {
                document.getElementById('audioPlayerContainer').style.display = 'none';
                if (this.audioPlayer) {
                    this.audioPlayer.pause();
                }
                if (this.isSyncing) {
                    this.syncPauseAudio();
                }
            },

            // ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
            joinLoversRoom() {
                if (!database) {
                    this.showMediaStatus('âŒ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¡', 'error');
                    return;
                }
                
                const userId = this.getOrCreateUserId();
                database.ref('rooms/' + this.LOVERS_ROOM + '/users/' + userId).set({
                    joinedAt: Date.now(),
                    lastSeen: Date.now(),
                    name: 'Ù…Ø³ØªØ®Ø¯Ù…'
                });
                
                // ğŸ”„ ØªØ­Ø¯ÙŠØ¯ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                this.isNewUser = true;
                localStorage.setItem('roomJoinTime', Date.now());
                
                this.setupRoomListeners();
                this.showMediaStatus('âœ… ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØºØ±ÙØ©! Ø§Ø·Ù„Ø¨ Ù…Ù† ØµØ¯ÙŠÙ‚Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙŠØ¶Ø§Ù‹', 'success');
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ
                setTimeout(() => {
                    this.isNewUser = false;
                }, 10000);
            },

            leaveRoom() {
                if (!database) return;
                
                const userId = this.getOrCreateUserId();
                database.ref('rooms/' + this.LOVERS_ROOM + '/users/' + userId).remove();
                document.getElementById('usersCount').textContent = '0';
                this.isNewUser = false;
                this.showMediaStatus('ğŸ‘‹ ØºØ§Ø¯Ø±Øª Ø§Ù„ØºØ±ÙØ©', 'info');
            },

            setupRoomListeners() {
                if (!database) return;
                
                // Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                database.ref('rooms/' + this.LOVERS_ROOM + '/users').on('value', (snapshot) => {
                    const users = snapshot.val();
                    const count = users ? Object.keys(users).length : 0;
                    document.getElementById('usersCount').textContent = count;
                    
                    if (count > 1) {
                        this.showMediaStatus(`ğŸ‰ Ø§Ù†Ø¶Ù… ØµØ¯ÙŠÙ‚Ùƒ! Ø§Ù„Ø¢Ù† ${count} Ø£Ø´Ø®Ø§Øµ ÙÙŠ Ø§Ù„ØºØ±ÙØ©`, 'success');
                        this.isSyncing = true;
                    }
                });

                // Ù…Ø³ØªÙ…Ø¹ Ù„Ù„ÙˆØ³Ø§Ø¦Ø· - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­
                database.ref('rooms/' + this.LOVERS_ROOM + '/media').on('value', (snapshot) => {
                    if (!this.isSyncing) return;
                    
                    const mediaData = snapshot.val();
                    if (mediaData) {
                        this.handleMediaSync(mediaData);
                    }
                });
            },

            // ğŸ”„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            handleMediaSync(mediaData) {
                const { currentMedia, isPlaying, currentTime, mediaType, title } = mediaData;
                
                if (mediaType === 'video' && currentMedia && this.videoPlayer) {
                    console.log('ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:', currentMedia);
                    
                    if (this.videoPlayer.src !== currentMedia) {
                        this.videoPlayer.src = currentMedia;
                        document.getElementById('videoPlayerContainer').style.display = 'block';
                        
                        // ğŸ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ØŒ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø¨Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
                        if (this.isNewUser && currentTime > 0) {
                            this.showSyncIndicator('ğŸ¯ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚...');
                            setTimeout(() => {
                                this.videoPlayer.currentTime = currentTime;
                                if (isPlaying) {
                                    this.videoPlayer.play().catch(e => {
                                        console.log('âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
                                    });
                                }
                                this.hideSyncIndicator();
                            }, 1000);
                        }
                    }
                    
                    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù‚Ø¯Ø§Ù…Ù‰ ÙŠØªØ§Ø¨Ø¹ÙˆÙ† Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                    if (!this.isNewUser) {
                        if (Math.abs(this.videoPlayer.currentTime - currentTime) > 2) {
                            this.videoPlayer.currentTime = currentTime;
                        }
                        
                        if (isPlaying && this.videoPlayer.paused) {
                            this.videoPlayer.play().catch(e => {
                                console.log('âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
                            });
                        } else if (!isPlaying && !this.videoPlayer.paused) {
                            this.videoPlayer.pause();
                        }
                    }
                }
                else if (mediaType === 'audio' && currentMedia) {
                    console.log('ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØµÙˆØª:', title);
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØµØ¯Ø± Ù…Ø®ØªÙ„ÙØŒ Ù‚Ù… Ø¨ØªØºÙŠÙŠØ±Ù‡
                    if (this.audioPlayer.src !== currentMedia) {
                        this.audioPlayer.src = currentMedia;
                        document.getElementById('audioInfo').textContent = title || 'ğŸµ ØµÙˆØª Ù…ØªØ²Ø§Ù…Ù†';
                        document.getElementById('audioMiniTitle').textContent = title || 'ğŸµ ØµÙˆØª Ù…ØªØ²Ø§Ù…Ù†';
                        
                        // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØµØ¨Ø­ Ø§Ù„ØµÙˆØª Ø¬Ø§Ù‡Ø²Ù‹Ø§
                        this.audioPlayer.addEventListener('canplay', () => {
                            if (this.isSyncing) {
                                // ğŸ¯ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
                                if (this.isNewUser && currentTime > 0) {
                                    this.audioPlayer.currentTime = currentTime;
                                }
                                if (isPlaying) {
                                    this.audioPlayer.play().catch(e => {
                                        console.log('âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
                                    });
                                }
                            }
                        }, { once: true });
                    } else {
                        // Ù†ÙØ³ Ø§Ù„Ù…ØµØ¯Ø±ØŒ ÙÙ‚Ø· Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø­Ø§Ù„Ø©
                        if (Math.abs(this.audioPlayer.currentTime - currentTime) > 2) {
                            this.audioPlayer.currentTime = currentTime;
                        }
                        
                        if (isPlaying && this.audioPlayer.paused) {
                            this.audioPlayer.play().catch(e => {
                                console.log('âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
                            });
                        } else if (!isPlaying && !this.audioPlayer.paused) {
                            this.audioPlayer.pause();
                        }
                    }
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ù…ØµØºØ±
                    this.showAudioMiniPlayer();
                }
                else if (mediaType === 'youtube' && currentMedia) {
                    // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª YouTube
                    console.log('ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© YouTube:', title);
                    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ù‡Ù†Ø§
                }
            },

            // ğŸµ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­
            syncPlayVideo() {
                if (!database || !this.videoPlayer) return;
                
                this.isSyncing = true;
                database.ref('rooms/' + this.LOVERS_ROOM + '/media').update({
                    currentMedia: this.videoPlayer.src,
                    isPlaying: true,
                    currentTime: this.videoPlayer.currentTime,
                    mediaType: 'video',
                    lastUpdate: Date.now()
                });
                console.log('ğŸ”„ ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
            },

            syncPauseVideo() {
                if (!database || !this.videoPlayer) return;
                
                this.isSyncing = true;
                database.ref('rooms/' + this.LOVERS_ROOM + '/media').update({
                    isPlaying: false,
                    currentTime: this.videoPlayer.currentTime,
                    lastUpdate: Date.now()
                });
                console.log('ğŸ”„ ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
            },

            syncPlayAudio() {
                if (!database || !this.audioPlayer) return;
                
                this.isSyncing = true;
                database.ref('rooms/' + this.LOVERS_ROOM + '/media').update({
                    currentMedia: this.audioPlayer.src,
                    isPlaying: true,
                    currentTime: this.audioPlayer.currentTime,
                    mediaType: 'audio',
                    title: document.getElementById('audioInfo').textContent,
                    lastUpdate: Date.now()
                });
                console.log('ğŸ”„ ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
            },

            syncPauseAudio() {
                if (!database || !this.audioPlayer) return;
                
                this.isSyncing = true;
                database.ref('rooms/' + this.LOVERS_ROOM + '/media').update({
                    isPlaying: false,
                    currentTime: this.audioPlayer.currentTime,
                    lastUpdate: Date.now()
                });
                console.log('ğŸ”„ ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª');
            },

            syncSkipAudio(seconds) {
                if (!this.audioPlayer || !this.audioPlayer.src) return;
                
                const newTime = this.audioPlayer.currentTime + seconds;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØµØ§Ù„Ø­
                if (newTime >= 0 && newTime <= (this.audioPlayer.duration || Infinity)) {
                    this.audioPlayer.currentTime = newTime;
                    
                    if (this.isSyncing && database) {
                        database.ref('rooms/' + this.LOVERS_ROOM + '/media').update({
                            currentTime: newTime,
                            lastUpdate: Date.now()
                        });
                    }
                }
            },

            // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙŠØ¯ÙŠÙˆ YouTube
            syncYouTubeVideo(embedUrl, title) {
                if (!database) return;
                
                this.isSyncing = true;
                database.ref('rooms/' + this.LOVERS_ROOM + '/media').update({
                    currentMedia: embedUrl,
                    isPlaying: true,
                    mediaType: 'youtube',
                    title: title,
                    lastUpdate: Date.now()
                });
            },

            // ğŸ”„ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
            syncJoinCurrentTime() {
                if (!database || !this.isNewUser) return;
                
                database.ref('rooms/' + this.LOVERS_ROOM + '/media/currentTime').once('value')
                    .then(snapshot => {
                        const currentTime = snapshot.val();
                        if (currentTime && currentTime > 0) {
                            console.log('ğŸ¯ Ø§Ù„ØªØ­Ø§Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ù„Ù‰:', currentTime);
                            this.showSyncIndicator('ğŸ¯ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚...');
                            
                            if (this.videoPlayer) {
                                this.videoPlayer.currentTime = currentTime;
                            }
                            
                            // Ø£ÙŠØ¶Ø§Ù‹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
                            database.ref('rooms/' + this.LOVERS_ROOM + '/media/isPlaying').once('value')
                                .then(playSnapshot => {
                                    const isPlaying = playSnapshot.val();
                                    if (isPlaying && this.videoPlayer && this.videoPlayer.paused) {
                                        this.videoPlayer.play().catch(e => {
                                            console.log('âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
                                        });
                                    }
                                    this.hideSyncIndicator();
                                });
                        }
                    })
                    .catch(error => {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚:', error);
                        this.hideSyncIndicator();
                    });
            },

            // ğŸ“Š Ù…Ø¤Ø´Ø± Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚
            showSyncIndicator(message) {
                const indicator = document.getElementById('syncIndicator');
                indicator.textContent = message;
                indicator.style.display = 'block';
            },

            hideSyncIndicator() {
                const indicator = document.getElementById('syncIndicator');
                indicator.style.display = 'none';
            },

            // â˜ï¸ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
            async uploadToCloudinaryMedia(e) {
                e.preventDefault();
                
                const file = document.getElementById('fileInput').files[0];
                if (!file) {
                    this.showMediaStatus('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„Ø±ÙØ¹', 'error');
                    return;
                }
                
                const submitBtn = document.getElementById('uploadSubmit');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="loader"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
                
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', this.cloudinaryConfig.uploadPreset);
                    
                    const resourceType = this.currentMediaType === 'video' ? 'video' : 'raw';
                    formData.append('resource_type', resourceType);
                    
                    this.showMediaStatus('â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù...', 'info');
                    
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${this.cloudinaryConfig.cloudName}/${resourceType}/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø±ÙØ¹');
                    
                    const data = await response.json();
                    
                    const mediaItem = {
                        url: data.secure_url,
                        publicId: data.public_id,
                        type: resourceType,
                        name: file.name,
                        size: data.bytes,
                        uploadedBy: this.getOrCreateUserId(),
                        timestamp: Date.now()
                    };
                    
                    const mediaRef = database.ref('media').push();
                    await mediaRef.set(mediaItem);
                    
                    this.showMediaStatus('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    document.getElementById('fileInput').value = '';
                    
                    this.loadMediaLibrary();
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹:', error);
                    this.showMediaStatus('âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù', 'error');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'â˜ï¸ Ø±ÙØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©';
                }
            },

            // ğŸ“š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø©
            loadMediaLibrary() {
                if (!database) return;
                
                database.ref('media').on('value', (snapshot) => {
                    const mediaData = snapshot.val();
                    const videosLibrary = document.getElementById('videosLibrary');
                    const audiosLibrary = document.getElementById('audiosLibrary');
                    
                    videosLibrary.innerHTML = '';
                    audiosLibrary.innerHTML = '';
                    
                    if (mediaData) {
                        let hasVideos = false;
                        let hasAudios = false;
                        
                        Object.values(mediaData).forEach(media => {
                            const mediaItem = this.createMediaElement(media);
                            if (media.type === 'video') {
                                videosLibrary.appendChild(mediaItem);
                                hasVideos = true;
                            } else {
                                audiosLibrary.appendChild(mediaItem);
                                hasAudios = true;
                            }
                        });
                        
                        if (!hasVideos) {
                            videosLibrary.innerHTML = '<div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #ccc;"><div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div><div>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¨Ø¹Ø¯</div></div>';
                        }
                        
                        if (!hasAudios) {
                            audiosLibrary.innerHTML = '<div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #ccc;"><div style="font-size: 48px; margin-bottom: 15px;">ğŸµ</div><div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØºØ§Ù†ÙŠ Ø¨Ø¹Ø¯</div></div>';
                        }
                    }
                });
            },

            createMediaElement(media) {
                const div = document.createElement('div');
                div.className = 'media-item';
                div.onclick = () => this.playMedia(media);
                
                div.innerHTML = `
                    <div class="media-icon">${media.type === 'video' ? 'ğŸ¬' : 'ğŸµ'}</div>
                    <div class="media-name">${media.name}</div>
                    <div style="font-size: 10px; color: #fdbb2d; margin-top: 5px;">${this.formatFileSize(media.size)}</div>
                `;
                
                return div;
            },

            playMedia(media) {
                console.log('ğŸ® ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·:', media);
                
                if (media.type === 'video') {
                    if (!this.videoPlayer) {
                        console.error('âŒ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…Ù‡ÙŠØ¡');
                        return;
                    }
                    
                    this.videoPlayer.src = media.url;
                    document.getElementById('videoPlayerContainer').style.display = 'block';
                    document.getElementById('videoTitle').textContent = `ğŸ¬ ${media.name}`;
                    this.closeModal('videosModal');
                    this.showMediaStatus('ğŸ¬ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'success');
                    
                    // ğŸ”„ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØºØ±ÙØ©
                    if (this.isInRoom() && this.isSyncing) {
                        this.videoPlayer.addEventListener('loadedmetadata', () => {
                            this.syncJoinCurrentTime();
                        }, { once: true });
                    }
                    
                    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØºØ±ÙØ©
                    if (this.isInRoom()) {
                        this.isSyncing = true;
                        setTimeout(() => this.syncPlayVideo(), 500);
                    }
                } else {
                    if (!this.audioPlayer) {
                        console.error('âŒ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ù‡ÙŠØ¡');
                        return;
                    }
                    
                    this.audioPlayer.src = media.url;
                    document.getElementById('audioInfo').textContent = media.name;
                    document.getElementById('audioMiniTitle').textContent = media.name;
                    document.getElementById('audioPlayerContainer').style.display = 'none';
                    this.showAudioMiniPlayer();
                    this.closeModal('audiosModal');
                    this.showMediaStatus('ğŸµ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª', 'success');
                    
                    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØºØ±ÙØ©
                    if (this.isInRoom()) {
                        this.isSyncing = true;
                        setTimeout(() => this.syncPlayAudio(), 500);
                    }
                }
            },

            // ğŸ”Š Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØª
            setAudioVolume(value) {
                if (this.audioPlayer) {
                    this.audioPlayer.volume = value / 100;
                    document.getElementById('volumeValue').textContent = value + '%';
                    document.getElementById('audioMiniVolume').textContent = value + '%';
                }
            },

            // ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØºØ±ÙØ©
            isInRoom() {
                const usersCount = document.getElementById('usersCount').textContent;
                return usersCount !== '0' && usersCount !== '0 Ù…ØªØµÙ„ÙŠÙ†';
            },

            // ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else return (bytes / 1048576).toFixed(1) + ' MB';
            },

            showMediaStatus(message, type) {
                const uploadStatus = document.getElementById('uploadStatus');
                uploadStatus.textContent = message;
                uploadStatus.className = `status-message ${type}`;
                setTimeout(() => {
                    uploadStatus.textContent = '';
                    uploadStatus.className = 'status-message'
                }, 5000);
            },

            showLinkStatus(message, type) {
                const linkStatus = document.getElementById('linkStatus');
                linkStatus.textContent = message;
                linkStatus.className = `status-message ${type}`;
                setTimeout(() => {
                    linkStatus.textContent = '';
                    linkStatus.className = 'status-message'
                }, 5000);
            }
        };

        // =================================================================
        // ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
        // =================================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
            
            // ØªÙ‡ÙŠØ¦Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            chatApp.init();
            
            // ØªÙ‡ÙŠØ¦Ø© Ù…Ø´ØºÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
            mediaPlayer.init();
        });
    </script>
</body>
</html>